{"version":3,"sources":["/pages/roles/roleUser/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport Table from 'ts/ui/Table.ts';\r\nimport {Languages} from 'ts/util/Languages';\r\nimport PopUp from 'ts/ui/Popup';\r\nimport {Cache} from 'ts/util/store';\r\nimport Panel from 'ts/ui/Panel';\r\nimport {ListBox} from '../../../ts/ui/FormControls';\r\n\r\n\r\nopg.api({\r\n\tgetAllRole: 'role/GetAllRole',\r\n\t'getRoleUserList!post': 'user/SearchUsersByRoleAndUserNameKeyword',\r\n\tdelRoleUser: 'user/DelUserRoleByUserIdAndRoleId',\r\n});\r\n\r\nconst lpg = Languages.package;\r\nconst moduleName = lpg.moduleName;\r\n\r\nconst form = $('#tbSearch');\r\nlet panel: Panel = opg.wrapPanel('#tbSearch', {\r\n\ttitle: `${moduleName}`,\r\n\tbtnSearchText: `<i class=\"ico-find\"></i> ${lpg.search}`,\r\n\tbtnSearchClick: function () {\r\n\t\tlet param = form.fieldsToJson();\r\n\t\tparam.pageIndex = 0;\r\n\t\ttb.update(param);\r\n\t},\r\n});\r\n\r\nlet selRole = opg('#roleId').listBox({\r\n\tapi: opg.api.getAllRole,\r\n\tautoPrependBlank: false,\r\n\t//text : 'desc'\r\n\t/*onSelect:function () {\r\n\t\tlet data = (this as ListBox).selectedData;\r\n\r\n\t\t\t$('#desc').text(data.desc || '');\r\n\r\n\t}*/\r\n});\r\n\r\n$.when(selRole.createdPromise).then(function () {\r\n\tpanel.btnSearch.trigger('click');\r\n});\r\n\r\nlet tb: Table = opg('#tb').table({\r\n\tapi: opg.api.getRoleUserList,\r\n\tlazy: true,\r\n\ttitleBar: {\r\n\t\ttitle: `${moduleName}${lpg.list}`,\r\n\t\tbuttons: [{id: 'btnAdd', className: 'btn-create', html: `<i class=\"ico ico-create\"></i> ${lpg.add}`}],\r\n\t},\r\n\tcolumns: [\r\n\t\t{\r\n\t\t\ttext: `ID`, width: 100,\r\n\t\t\tsrc: 'user_id',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.userName}`,\r\n\t\t\tsrc: 'username',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.realName}`,\r\n\t\t\tsrc: 'firstname',\r\n\t\t\trender: (fn ,i , row)=> `${fn||''} ${row.lastname||''}`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.roleName}`,\r\n\t\t\tsrc: 'name',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.process}`,\r\n\t\t\tsrc: 'user_id',\r\n\t\t\twidth: 100,\r\n\t\t\trender: function (id, i, row) {\r\n\t\t\t\t//console.log(arr);\r\n\t\t\t\treturn `\r\n\t\t\t\t\t\t<button class=\"btn-mini btn-danger\" data-id=\"${id}\" data-title=\"${row.username}\">${lpg.del}</button>\r\n\t\t\t\t`;\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n\tpagination: true,\r\n});\r\n\r\nlet cache: Cache = Cache.getInstance();\r\n\r\nconst infoPage = __uri('/pages/roles/roleUser/info.html').split('?')[0];\r\n\r\n\r\n//Add\r\n$('#btnAdd').click(function () {\r\n\r\n\tlet pop = top.opg.confirm(`<iframe src=\"${infoPage}?roleId=${selRole.getValue()}\" />`, function (i, ifr) {\r\n\t\treturn ifr.doSave(pop, tb);\r\n\t}, {\r\n\t\ttitle: `${lpg.add}${moduleName}`,\r\n\t\tbtnMax: true,\r\n\t\twidth: 700,\r\n\t\theight: 550,\r\n\t\tbuttons: {\r\n\t\t\tok: `${lpg.save}${moduleName}`,\r\n\t\t\tcancel: lpg.cancel,\r\n\t\t},\r\n\t});\r\n});\r\n\r\n\r\n//del\r\ntb.tbody.on('click', '.btn-danger', function () {\r\n\tlet btn = $(this), title = btn.data('title'), roleId = btn.data('id');\r\n\r\n\topg.danger(`${lpg.del} [<b>${title}</b>] ? `, function () {\r\n\t\topg.api.delRoleUser({roleId}, () => tb.update());\r\n\t}, {\r\n\t\ttitle: `${lpg.please}${lpg.confirm}`,\r\n\t});\r\n});\r\n"]}