{"version":3,"sources":["/pages/roles/roleRights/index.ts"],"names":[],"mappings":";;;;AAAA,oCAA4B;AAC5B,+CAA4C;AAI5C,gBAAG,CAAC,GAAG,CAAC;IACP,UAAU,EAAE,iBAAiB;IAC7B,eAAe,EAAE,6BAA6B;IAC9C,cAAc,EAAE,gCAAgC;IAChD,aAAa,EAAE,gCAAgC;IAC/C,mBAAmB,EAAE,mBAAmB;CACxC,CAAC,CAAC;AAEH,IAAM,kBAAkB,GAAG,gBAAG,CAAC,GAAG,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;AAC3D,IAAM,GAAG,GAAG,qBAAS,CAAC,OAAO,CAAC;AAC9B,IAAM,UAAU,GAAG,GAAG,CAAC,UAAU,CAAC;AAElC,IAAM,IAAI,GAAG,CAAC,CAAC,WAAW,CAAC,EAAE,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC;AACjD,IAAI,OAAO,EAAE,MAAM,CAAC;AACpB,IAAI,KAAK,GAAU,gBAAG,CAAC,SAAS,CAAC,WAAW,EAAE;IAC7C,KAAK,EAAE,KAAG,UAAY;IACtB,WAAW,EAAE,IAAI;CACjB,CAAC,CAAC;AAEH,IAAI,OAAO,GAAY,gBAAG,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC;IAC7C,GAAG,EAAE,gBAAG,CAAC,GAAG,CAAC,UAAU;IACvB,gBAAgB,EAAE,KAAK;IACvB,QAAQ,EAAE;QACT,IAAI,IAAI,GAAI,IAAgB,CAAC,YAAY,CAAC;QAC1C,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC;QAC7B,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC5B,CAAC;CACD,CAAC,CAAC;AAEH,SAAS,SAAS,CAAC,MAAM;IACxB,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;IACtC,gBAAG,CAAC,GAAG,CAAC,eAAe,CAAC,EAAC,MAAM,UAAC,EAAE,UAAU,IAAI;QAC/C,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG;YACrB,IAAI,EAAE,GAAG,GAAG,CAAC,EAAE,CAAC;YAChB,IAAI,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAI,OAAO,CAAC,QAAQ,YAAO,EAAI,CAAC,CAAC;YAClE,IAAI,CAAC,GAAG,EAAE;gBACT,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAI,MAAM,CAAC,QAAQ,YAAO,EAAI,CAAC,CAAC;aAC7D;YACD,IAAI,GAAG,EAAE;gBACP,GAAwB,CAAC,OAAO,GAAG,IAAI,CAAC;aACzC;QACF,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AACJ,CAAC;AAED,CAAC,CAAC,IAAI,CACL,OAAO,CAAC,cAAc,EACtB,gBAAG,CAAC,GAAG,CAAC,cAAc,CAAC,UAAC,IAAI;IAC3B,OAAO,GAAG,gBAAG,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC;QAClC,IAAI,EAAE,IAAI;QACV,IAAI,EAAE,SAAS;QACf,IAAI,EAAE,cAAc;QACpB,GAAG,EAAE,UAAU;QACf,QAAQ,EAAE,YAAY;KACtB,CAAC,CAAC;AACJ,CAAC,CAAC,EACF,gBAAG,CAAC,GAAG,CAAC,aAAa,CAAC,UAAC,IAAI;IAC1B,MAAM,GAAG,gBAAG,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC;QAChC,IAAI,EAAE,IAAI;QACV,IAAI,EAAE,QAAQ;QACd,IAAI,EAAE,gBAAgB;QACtB,GAAG,EAAE,UAAU;QACf,QAAQ,EAAE,YAAY;KACtB,CAAC,CAAC;AACJ,CAAC,CAAC,CACF,CAAC,IAAI,CAAC;IACN,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC9B,CAAC,CAAC,CAAC;AAGH,CAAC,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC;IACnB,IAAI,GAAG,GAAG,EAAE,CAAC;IAGb,CAAC,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,IAAsB;QACrE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAEvB,IAAI,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAEnC,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,EAAE;YAC9B,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACrD,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBAC1B,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;SACjB;IACF,CAAC,CAAC,CAAC;IAEH,IAAI,GAAG,GAAG,gBAAG,CAAC,GAAG,CAAC,YAAY,CAAC;IAC/B,GAAG,CAAC,GAAG,CAAC,KAAK,EAAK,kBAAkB,SAAI,OAAO,CAAC,QAAQ,EAAI,CAAC,CAAC;IAC9D,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACjB,OAAO,CAAC,GAAG,CAAC,gBAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;IAElC,gBAAG,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE;IAE1B,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","file":"index.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport {Languages} from 'ts/util/Languages';\r\nimport Panel from 'ts/ui/Panel';\r\nimport {ListBox} from '../../../ts/ui/FormControls';\r\n\r\nopg.api({\r\n\tgetAllRole: 'role/GetAllRole',\r\n\tgetMenuByRoleId: 'role/GetRoleAllMenuByRoleId',\r\n\tgetFullMenuWap: 'menu/GetMenusByType?menutype=0',\r\n\tgetFullMenuPc: 'menu/GetMenusByType?menutype=1',\r\n\t'addRoleMenus!post': 'role/addrolemenus',\r\n});\r\n\r\nconst apiAddRoleMenusUrl = opg.api.addRoleMenus.toString();\r\nconst lpg = Languages.package;\r\nconst moduleName = lpg.moduleName;\r\n\r\nconst form = $('#tbSearch'), spDesc = $('#desc');\r\nlet treeWap, treePC;\r\nlet panel: Panel = opg.wrapPanel('#tbSearch', {\r\n\ttitle: `${moduleName}`,\r\n\tbtnSearchId: null,\r\n});\r\n\r\nlet selRole: ListBox = opg('#roleId').listBox({\r\n\tapi: opg.api.getAllRole,\r\n\tautoPrependBlank: false,\r\n\tonSelect: function () {\r\n\t\tlet data = (this as ListBox).selectedData;\r\n\t\tspDesc.text(data.desc || '');\r\n\t\tmakeMenus(this.getValue());\r\n\t},\r\n});\r\n\r\nfunction makeMenus(roleId) {\r\n\t$(':checkbox').prop('checked', false);\r\n\topg.api.getMenuByRoleId({roleId}, function (data) {\r\n\t\tdata.map(function (val) {\r\n\t\t\tlet id = val.id;\r\n\t\t\tlet dom = document.getElementById(`${treeWap.treeName}Chk_${id}`);\r\n\t\t\tif (!dom) {\r\n\t\t\t\tdom = document.getElementById(`${treePC.treeName}Chk_${id}`);\r\n\t\t\t}\r\n\t\t\tif (dom) {\r\n\t\t\t\t(dom as HTMLInputElement).checked = true;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n$.when(\r\n\tselRole.createdPromise,\r\n\topg.api.getFullMenuWap((data) => {\r\n\t\ttreeWap = opg('#treeMenuWap').tree({\r\n\t\t\tdata: data,\r\n\t\t\tname: 'treeWap',\r\n\t\t\troot: 'App / WeChat',\r\n\t\t\tcmd: 'checkAll',\r\n\t\t\tchildSrc: 'childMenus',\r\n\t\t});\r\n\t}),\r\n\topg.api.getFullMenuPc((data) => {\r\n\t\ttreePC = opg('#treeMenuPC').tree({\r\n\t\t\tdata: data,\r\n\t\t\tname: 'treePC',\r\n\t\t\troot: 'Web / back-end',\r\n\t\t\tcmd: 'checkAll',\r\n\t\t\tchildSrc: 'childMenus',\r\n\t\t});\r\n\t}),\r\n).then(function () {\r\n\tselRole.jq.trigger('change');\r\n});\r\n\r\n\r\n$('#btnSave').click(function () {\r\n\tlet arr = [];\r\n\r\n\r\n\t$(':checkbox:checked', '#tb').each(function (i, elem: HTMLInputElement) {\r\n\t\tarr.push(~~elem.value);\r\n\r\n\t\tlet span = $(elem).closest('span');\r\n\r\n\t\tif (span.data('depth') == '2') {\r\n\t\t\tlet ul = span.closest('ul'), pId = ul.data('parent');\r\n\t\t\tif (arr.indexOf(pId) === -1)\r\n\t\t\t\tarr.push(~~pId);\r\n\t\t}\r\n\t});\r\n\r\n\tlet api = opg.api.addRoleMenus;\r\n\tapi.set('url', `${apiAddRoleMenusUrl}/${selRole.getValue()}`);\r\n\tconsole.log(arr);\r\n\tconsole.log(opg.api.addRoleMenus);\r\n\r\n\topg.api.addRoleMenus(arr, function () {\r\n\r\n\t});\r\n});\r\n"]}