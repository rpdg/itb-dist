{"version":3,"sources":["/pages/login/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import {store} from 'ts/util/store.ts';\r\nimport opg from 'ts/opg.ts';\r\n\r\nimport {Languages} from 'ts/util/Languages';\r\n\r\nconsole.log(Languages);\r\n\r\nstore.set('apiServer', window.CONFIG.apiServer);\r\nstore.set('loginPage', window.CONFIG.loginPage);\r\n\r\nconst rememberedUserNameKey = 'login-userParam';\r\n\r\n\r\n\r\nopg.api({\r\n\t'login!post': 'user/login',\r\n});\r\n\r\n\r\n$('#switcher').on('click' , '.s' , function () {\r\n\t// 不能用Store，避开Store的自动序列化\r\n\tlocalStorage.setItem(Languages.configKeyName,\r\n\t\tLanguages.current === Languages.names.cn? Languages.names.en:Languages.names.cn);\r\n\r\n\tlocation.reload(true);\r\n});\r\n\r\nlet form = $('#loginForm');\r\n\r\n\r\n\r\ntype userParam = {\r\n\tusername: string;\r\n\tpassword: string;\r\n}\r\n\r\n\r\nlet remed = store.get(rememberedUserNameKey);\r\nif(remed){\r\n\tsetTimeout(function () {\r\n\t\tform.jsonToFields(remed);\r\n\t}, 200);\r\n\r\n\t$('#remPassword').prop('checked' , true);\r\n}\r\n\r\n\r\ndocument.getElementById('guestLogin').addEventListener('click', function () {\r\n\tlet param: userParam = {\"username\": \"guest\", \"password\": \"123456\"};\r\n\tLogin(param);\r\n});\r\n\r\nfunction Login(param: userParam) {\r\n\r\n\topg.api.login(param, function (data) {\r\n\r\n\t\tlet url = __uri('./main.html');\r\n\r\n\t\tlet previousLoginName = store.get('user');\r\n\t\t//debugger;\r\n\t\tif (previousLoginName && previousLoginName === param.username) {\r\n\t\t\tlet hash = opg.request['ReturnUrl'];\r\n\t\t\tif (hash) {\r\n\t\t\t\turl += hash;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstore.set('Authorization', data);\r\n\t\tstore.set('user', param.username);\r\n\r\n\r\n\t\twindow.location.replace(url);\r\n\r\n\t});\r\n\r\n}\r\n\r\n\r\n$('#btnLogin').click(function () {\r\n\r\n\tlet param = form.fieldsToJson({\r\n\t\tusername: {\r\n\t\t\tname: Languages.package.loginName,\r\n\t\t\trequire: true,\r\n\t\t},\r\n\t\tpassword: {\r\n\t\t\tname: Languages.package.password,\r\n\t\t\trequire: true,\r\n\t\t},\r\n\t});\r\n\r\n\tif (param) {\r\n\t\tLogin(param);\r\n\r\n\t\tif ($('#remPassword').prop('checked')) {\r\n\t\t\tdelete param.remPassword;\r\n\t\t\tstore.set(rememberedUserNameKey, param);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstore.remove(rememberedUserNameKey);\r\n\t\t}\r\n\r\n\t}\r\n});\r\n\r\n\r\n$('#guestLogin').on('click', function () {\r\n\tlet param: userParam = {username: \"guest\", password: \"123456\"};\r\n\tLogin(param);\r\n});"]}