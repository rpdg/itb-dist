{"version":3,"sources":["/pages/login/91b332fb641e43de9709332565af93da.ts"],"names":[],"mappings":"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","file":"91b332fb641e43de9709332565af93da.js","sourcesContent":["import {store} from 'ts/util/store.ts';\r\nimport opg from 'ts/opg.ts';\r\n\r\nimport {Languages} from 'ts/util/Languages';\r\nimport PopUp from \"../../ts/ui/Popup\";\r\nimport {request} from 'ts/util/utils';\r\n\r\nconsole.log(Languages);\r\n\r\nstore.set('apiServer', window.CONFIG.apiServer);\r\nstore.set('loginPage', window.CONFIG.loginPage);\r\n\r\nconst rememberedUserNameKey = 'login-userParam';\r\nconst dontneedtoinputagain = 'dontneedtoinputagain';\r\n\r\n\r\nopg.api({\r\n    //'login!post': 'user/login',\r\n    //'login!post': 'user/backendlogin'\r\n    'login!post':'user/Tobackendlogin'\r\n    // 'forgetPwd': 'user/ForgetPwd',\r\n    // 'ToRegistrationFindPwd!post':'user/ToRegistrationFindPwd'\r\n});\r\n\r\n\r\n// $('#switcher').on('click', '.s', function () {\r\n//     // 不能用Store，避开Store的自动序列化\r\n//     localStorage.setItem(Languages.configKeyName,\r\n//         Languages.current === Languages.names.cn ? Languages.names.en : Languages.names.cn);\r\n\r\n//     setTimeout(function () {\r\n//         let param = form.fieldsToJson({\r\n//             username: {},\r\n//             password: {},\r\n//         });\r\n\r\n//         store.set(dontneedtoinputagain, param);\r\n//     }, 300);\r\n\r\n//     setTimeout(function () {\r\n//         location.reload(true);\r\n//     }, 500);\r\n\r\n// });\r\n\r\nlet form = $('#loginForm');\r\nconst u = request['u'];\r\nconst p = request['p'];\r\n\r\n$(\"#loginName\").val(u);\r\n$(\"#password\").val(p);\r\n\r\ntype userParam = {\r\n    username: string;\r\n    password: string;\r\n}\r\n\r\n\r\nlet dont = store.get(dontneedtoinputagain);\r\nif (dont) {\r\n    setTimeout(function () {\r\n        form.jsonToFields(dont);\r\n    }, 200);\r\n    store.remove(dontneedtoinputagain);\r\n}\r\n\r\n\r\nlet remed = store.get(rememberedUserNameKey);\r\nif (remed) {\r\n    setTimeout(function () {\r\n        form.jsonToFields(remed);\r\n    }, 200);\r\n\r\n    $('#remPassword').prop('checked', true);\r\n}\r\n\r\n\r\n// document.getElementById('guestLogin').addEventListener('click', function () {\r\n//     let param: userParam = {\"username\": \"guest\", \"password\": \"123456\"};\r\n//     Login(param);\r\n// });\r\n\r\n// $(document).keypress(function (e) {\r\n//     // 回车键事件\r\n//     if (e.which == 13) {\r\n//         $('#btnLogin').trigger('click');\r\n//     }\r\n// });\r\n\r\nfunction Login(param: userParam) {\r\n\r\n    opg.api.login(param, function (data) {\r\n\r\n        let url = __uri('./main.html');\r\n\r\n        let previousLoginName = store.get('user');\r\n        //debugger;\r\n        if (previousLoginName && previousLoginName === param.username) {\r\n            let hash = opg.request['ReturnUrl'];\r\n            if (hash) {\r\n                url += hash;\r\n            }\r\n        }\r\n\r\n        store.set('Authorization', data);\r\n        store.set('user', param.username);\r\n\r\n\r\n        window.location.replace(url);\r\n\r\n    });\r\n\r\n}\r\n\r\n\r\n$('#btnLogin').click(function () {\r\n\r\n    let param = form.fieldsToJson({\r\n        username: {\r\n            name: Languages.package.loginName\r\n        },\r\n        password: {\r\n            name: Languages.package.password\r\n        }\r\n    });\r\n    console.log\r\n\r\n    if (param) {\r\n        console.log(param);\r\n\r\n        Login(param);\r\n\r\n        if ($('#remPassword').prop('checked')) {\r\n            delete param.remPassword;\r\n            store.set(rememberedUserNameKey, param);\r\n        }\r\n        else {\r\n            store.remove(rememberedUserNameKey);\r\n        }\r\n\r\n    }\r\n});\r\n\r\n\r\nsetTimeout(function(){\r\n    $(\"#btnLogin\").trigger('click');\r\n},1000);\r\n\r\n\r\n// $('#forgetPwd').click(function () {\r\n//     let param={};\r\n    \r\n\r\n    \r\n//     if ($.trim($(\"#loginName\").val())!=\"\") {\r\n//         opg.api.ToRegistrationFindPwd(param, function (data) {\r\n\r\n//             //console.log(data);\r\n//             location.href=data[0].address + \"/Pages/web/ResetPasswordSelect.shtml?language=\" + Languages.current + \"&email=\" + $(\"#loginName\").val() + \"&_=\" + Date.parse(new Date());\r\n\r\n//         });\r\n        \r\n//     }\r\n//     else {\r\n//         opg.warn(Languages.package.forgetPwdTipWarn);\r\n//     }\r\n//     //http://localhost:12575/\r\n//     //http://reg.itb-china.com\r\n//     // let param = form.fieldsToJson({\r\n//     //     username: {\r\n//     //         name: Languages.package.loginName,\r\n//     //         require: true,\r\n//     //     }\r\n//     // });\r\n//     // if (param) {\r\n//     //     opg.api.forgetPwd({email: param.username}, (data) => {\r\n//     //         opg.ok(Languages.package.forgetPwdTipOk);\r\n//     //         console.log(data);\r\n//     //     });\r\n//     // }\r\n// });\r\n\r\n\r\n"]}