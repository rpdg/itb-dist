{"version":3,"sources":["/pages/login/admin.ts"],"names":[],"mappings":"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","file":"admin.js","sourcesContent":["import {store} from 'ts/util/store.ts';\r\nimport opg from 'ts/opg.ts';\r\n\r\nimport {Languages} from 'ts/util/Languages';\r\nimport PopUp from \"../../ts/ui/Popup\";\r\n\r\nconsole.log(Languages);\r\n\r\nstore.set('apiServer', window.CONFIG.apiServer);\r\nstore.set('loginPage', window.CONFIG.loginPage);\r\n\r\nconst rememberedUserNameKey = 'login-userParam';\r\nconst dontneedtoinputagain = 'dontneedtoinputagain';\r\n\r\n\r\nopg.api({\r\n    'login!post': 'user/adminlogin',\r\n    'forgetPwd': 'user/ForgetPwd'\r\n});\r\n\r\n\r\n$('#switcher').on('click', '.s', function () {\r\n    // 不能用Store，避开Store的自动序列化\r\n    localStorage.setItem(Languages.configKeyName,\r\n        Languages.current === Languages.names.cn ? Languages.names.en : Languages.names.cn);\r\n\r\n    setTimeout(function () {\r\n        let param = form.fieldsToJson({\r\n            username: {},\r\n            password: {},\r\n        });\r\n\r\n        store.set(dontneedtoinputagain, param);\r\n    }, 300);\r\n\r\n    setTimeout(function () {\r\n        location.reload(true);\r\n    }, 500);\r\n\r\n});\r\n\r\nlet form = $('#loginForm');\r\n\r\n\r\ntype userParam = {\r\n    username: string;\r\n    password: string;\r\n}\r\n\r\n\r\nlet dont = store.get(dontneedtoinputagain);\r\nif (dont) {\r\n    setTimeout(function () {\r\n        form.jsonToFields(dont);\r\n    }, 200);\r\n    store.remove(dontneedtoinputagain);\r\n}\r\n\r\n\r\n// let remed = store.get(rememberedUserNameKey);\r\n// if (remed) {\r\n//     setTimeout(function () {\r\n//         form.jsonToFields(remed);\r\n//     }, 200);\r\n//\r\n//     $('#remPassword').prop('checked', true);\r\n// }\r\n\r\n\r\n// document.getElementById('guestLogin').addEventListener('click', function () {\r\n//     let param: userParam = {\"username\": \"guest\", \"password\": \"123456\"};\r\n//     Login(param);\r\n// });\r\n\r\n$(document).keypress(function (e) {\r\n    // 回车键事件\r\n    if (e.which == 13) {\r\n        $('#btnLogin').trigger('click');\r\n    }\r\n});\r\n\r\nfunction Login(param: userParam) {\r\n\r\n    opg.api.login(param, function (data) {\r\n\r\n        let url = __uri('./main.html');\r\n\r\n        let previousLoginName = store.get('user');\r\n        //debugger;\r\n        if (previousLoginName && previousLoginName === param.username) {\r\n            let hash = opg.request['ReturnUrl'];\r\n            if (hash) {\r\n                url += hash;\r\n            }\r\n        }\r\n\r\n        store.set('Authorization', data);\r\n        store.set('user', param.username);\r\n\r\n\r\n        window.location.replace(url);\r\n\r\n    });\r\n\r\n}\r\n\r\n\r\n$('#btnLogin').click(function () {\r\n\r\n    let param = form.fieldsToJson({\r\n        username: {\r\n            name: Languages.package.loginName,\r\n            require: true,\r\n        },\r\n        password: {\r\n            name: Languages.package.password,\r\n            require: true,\r\n        },\r\n    });\r\n\r\n    if (param) {\r\n        Login(param);\r\n\r\n        if ($('#remPassword').prop('checked')) {\r\n            delete param.remPassword;\r\n            store.set(rememberedUserNameKey, param);\r\n        }\r\n        else {\r\n            store.remove(rememberedUserNameKey);\r\n        }\r\n\r\n    }\r\n});\r\n\r\n// $('#forgetPwd').click(function () {\r\n//     let param = form.fieldsToJson({\r\n//         username: {\r\n//             name: Languages.package.loginName,\r\n//             require: true,\r\n//         }\r\n//     });\r\n//     if (param) {\r\n//         opg.api.forgetPwd({email: param.username}, (data) => {\r\n//             opg.ok(Languages.package.forgetPwdTipOk);\r\n//             console.log(data);\r\n//         });\r\n//     }\r\n// });\r\n\r\n\r\n"]}