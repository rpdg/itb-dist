{"version":3,"sources":["/pages/content/message/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport Panel from 'ts/ui/Panel.ts';\r\nimport Table from 'ts/ui/Table.ts';\r\nimport {Combo} from 'ts/ui/Combo';\r\nimport {Languages} from 'ts/util/Languages';\r\nimport {store} from '../../../ts/util/store';\r\nimport PopUp from \"../../../ts/ui/Popup\";\r\n\r\nconsole.log('Languages:', Languages);\r\n\r\nopg.api({\r\n\tgetAllRole: 'role/GetAllRole',\r\n\t'getRoleUserList!post': 'user/SearchUsersByRoleAndUserNameKeyword',\r\n\t'sendMessageToUsers!post': 'message/SendMessageToUsers',\r\n\t'sendMessageToAll!post': 'message/SendMessageToAllUsers',\r\n});\r\n\r\nconst lpg = Languages.package;\r\n\r\nconst form = $('#tbSearch');\r\n\r\nlet panel: Panel = opg.wrapPanel('#tbSearch', {\r\n\ttitle: `${lpg.searchUser}`,\r\n\tbtnSearchText: `<i class=\"ico-find\"></i> ${lpg.search}`,\r\n\tbtnSearchClick: function () {\r\n\t\tlet param = $('#tbSearch').fieldsToJson();\r\n\t\tparam.pageIndex = 0;\r\n\t\ttb.update(param);\r\n\t},\r\n});\r\n\r\nlet selRole = opg('#roleId').listBox({\r\n\tapi: opg.api.getAllRole,\r\n\t/*onSelect:function () {\r\n\t\tlet data = (this as ListBox).selectedData;\r\n\r\n\t\t\t$('#desc').text(data.desc || '');\r\n\r\n\t}*/\r\n});\r\n$.when(selRole.createdPromise).then(function () {\r\n\tpanel.btnSearch.trigger('click');\r\n});\r\n\r\n\r\nconst permission = store.get('permission');\r\nlet tbButtons = [];\r\nif (permission) {\r\n\tif (permission['SendMessage']) {\r\n\t\ttbButtons.push({id: 'btnBatchSend', className: 'btn-warning', html: `${lpg.sendBatchMsg}`});\r\n\t}\r\n}\r\n\r\n\r\nlet tb: Table = opg('#tb').table({\r\n\tapi: opg.api.getRoleUserList,\r\n\tlazy: true,\r\n\ttitleBar: {\r\n\t\ttitle: `${lpg.list}`,\r\n\t\tbuttons: tbButtons,\r\n\t},\r\n\tcolumns: [\r\n\t\t{\r\n\t\t\ttext: 'ID', width: 60,\r\n\t\t\tsrc: 'user_id',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.userName}`, width: 100,\r\n\t\t\tsrc: 'username',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.roleName}`, width: 100,\r\n\t\t\tsrc: 'name',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.email}`, width: 200,\r\n\t\t\tsrc: 'email',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.barcode}`, width: 200,\r\n\t\t\tsrc: 'barcode',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: `${lpg.qrcode}`,\r\n\t\t\tsrc: 'qrcode',\r\n\t\t\trender: qrcode => `<img src=\"${qrcode}\" />`\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: lpg.process,\r\n\t\t\tsrc: 'user_id',\r\n\t\t\twidth: 230,\r\n\t\t\trender: function (id, index, row) {\r\n\t\t\t\tlet html = '';\r\n\t\t\t\tif (permission['SendMessage']) {\r\n\t\t\t\t\thtml += `<button data-id=\"${id}\" data-name=\"${row.username}\" class=\"btn-mini btn-warning sendOne\">${lpg.sendMsg}</button> `;\r\n\t\t\t\t}\r\n\t\t\t\tif (permission['QueryMessage']) {\r\n\t\t\t\t\thtml += `<button data-id=\"${id}\" data-name=\"${row.username}\" class=\"btn-mini btn-info\">${lpg.viewThisUserAllMsg}</button> `;\r\n\t\t\t\t}\r\n\t\t\t\treturn html;\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n\tpagination: true,\r\n});\r\n\r\n\r\n//view\r\nconst infoPage = __uri('/pages/content/message/view.html').split('?')[0];\r\ntb.tbody.on('click', '.btn-info', function () {\r\n\tlet btn = $(this), id = btn.data('id'), name = btn.data('name');\r\n\tlet pop = opg.popTop(`<iframe src=\"${infoPage}?id=${id}\" />`, {\r\n\t\ttitle: `${lpg.viewThisUserAllMsg}: ${name}`,\r\n\t\tbtnMax: true,\r\n\t\twidth: 900,\r\n\t\theight: 550,\r\n\t\tonClose: function () {\r\n\t\t\ttb.update();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n\r\nconst addPage = __uri('/pages/content/message/send.html');\r\n//send\r\ntb.tbody.on('click', '.btn-warning', function () {\r\n\tlet btn = $(this), id = btn.data('id'), name = btn.data('name');\r\n\tlet pop = opg.popTop(`<iframe src=\"${addPage}\" />`, {\r\n\t\ttitle: `${lpg.sendMsg}: ${name}`,\r\n\t\twidth: 600,\r\n\t\theight: 420,\r\n\t\tbuttons: {\r\n\t\t\tsend: {\r\n\t\t\t\tclassName: 'btn-success',\r\n\t\t\t\ttext: lpg.sendMsg,\r\n\t\t\t\tonClick: function (i, ifr) {\r\n\t\t\t\t\tconsole.log(id);\r\n\t\t\t\t\tlet msg = ifr.getMsg();\r\n\t\t\t\t\tif (msg)\r\n\t\t\t\t\t\tsendMsg([id], msg, pop);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcancel: lpg.cancel\r\n\t\t}\r\n\t});\r\n});\r\n\r\n\r\n//batch send\r\n$('#btnBatchSend').click(function () {\r\n\r\n\tlet pop = opg.popTop(`<iframe src=\"${addPage}\" />`, {\r\n\t\ttitle: `${lpg.sendBatchMsg}`,\r\n\t\twidth: 600,\r\n\t\theight: 420,\r\n\t\tbuttons: {\r\n\t\t\tsend: {\r\n\t\t\t\tclassName: 'btn-warning',\r\n\t\t\t\ttext: lpg.sendMsgToThisPage,\r\n\t\t\t\tonClick: function (i, ifr) {\r\n\t\t\t\t\tlet msg = ifr.getMsg();\r\n\t\t\t\t\tif (msg){\r\n\t\t\t\t\t\tlet ids =[];\r\n\t\t\t\t\t\ttb.data.map(function (user) {\r\n\t\t\t\t\t\t\tids.push(user.user_id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsendMsg(ids , msg, pop);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsendAll: {\r\n\t\t\t\tclassName: 'btn-success',\r\n\t\t\t\ttext: lpg.sendMsgToAll,\r\n\t\t\t\tonClick: function (i, ifr) {\r\n\t\t\t\t\tlet msg = ifr.getMsg();\r\n\t\t\t\t\tif (msg)\r\n\t\t\t\t\t\topg.api.sendMessageToAll(msg , ()=>{\r\n\t\t\t\t\t\t\tpop.close();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcancel: lpg.cancel\r\n\t\t}\r\n\t});\r\n});\r\n\r\n\r\nfunction sendMsg(userIds: Array, message: IMessage, pop: PopUp) {\r\n\topg.api.sendMessageToUsers({userIds, message}, function (data) {\r\n\t\tpop.close();\r\n\t});\r\n}\r\n\r\ninterface IMessage {\r\n\tmsgType: number;\r\n\tmsgTitle: string;\r\n\tmsgContent: string;\r\n}"]}