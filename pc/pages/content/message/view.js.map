{"version":3,"sources":["/pages/content/message/view.ts"],"names":[],"mappings":"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","file":"view.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport Table from 'ts/ui/Table.ts';\r\nimport {Languages} from 'ts/util/Languages';\r\nimport {store} from 'ts/util/store.ts';\r\n\r\nconsole.log('Languages:', Languages);\r\n\r\nopg.api({\r\n    getMsg: 'message/GetMessageByUserId',\r\n    delMsg: 'message/DelMessageByMsgId',\r\n});\r\n\r\nconst userId = opg.request['id'];\r\nconst lpg = Languages.package;\r\nconst msgTypes = {\r\n    0: lpg.msg0,\r\n    1: lpg.msg1,\r\n    2: lpg.msg1,\r\n};\r\nlet selStatus = $('#status').on('change', function () {\r\n    tb.update({status: selStatus.val()});\r\n});\r\n\r\nlet curLng = store.get('lngPkg');\r\nlet customParse = function (msg) {\r\n    let msgObj = JSON.parse(msg);\r\n    if (curLng == 'cn') {\r\n        return Languages.package['scheduleMsgTpl']\r\n            .replace('{company}', msgObj.fromCompanyCn ? `${msgObj.fromCompanyCn}公司` : '')\r\n            .replace('{title}', msgObj.fromTitleCn ? `${msgObj.fromTitleCn}` : '')\r\n            .replace('{name}', msgObj.fromNameCn)\r\n            .replace('{time}', msgObj.date);\r\n    } else {\r\n        return Languages.package['scheduleMsgTpl']\r\n            .replace('{company}', msgObj.fromCompany ? `${msgObj.fromCompany} Company ` : '')\r\n            .replace('{title}', msgObj.fromTitle ? `${msgObj.fromTitle}` : '')\r\n            .replace('{name}', msgObj.fromName)\r\n            .replace('{time}', msgObj.date);\r\n    }\r\n};\r\n\r\nlet tb: Table = opg('#tb').table({\r\n    api: opg.api.getMsg,\r\n    param: {\r\n        userId: userId,\r\n        status: 0,\r\n    },\r\n    columns: [\r\n        {\r\n            text: lpg.msgSender,\r\n            src: 'firstname',\r\n            width: 100,\r\n            render: function (firstname, i, row) {\r\n                return firstname + (row.lastname || '');\r\n            },\r\n        },\r\n        {\r\n            text: lpg.msgTitle,\r\n            src: 'msgtitle',\r\n            width: 200,\r\n        },\r\n        {\r\n            text: lpg.msgType,\r\n            src: 'msgtype',\r\n            width: 100,\r\n            render: type => msgTypes[type],\r\n        },\r\n        {\r\n            text: lpg.msgContent,\r\n            align: 'left',\r\n            //src: 'msgcontent',\r\n            render: (id, index, row) => {\r\n                if (row.msgtype == 3) {\r\n                    return customParse(row.msgcontent);\r\n                } else {\r\n                    return row.msgcontent;\r\n                }\r\n            }\r\n        },\r\n        {\r\n            text: lpg.process,\r\n            src: 'id',\r\n            width: 80,\r\n            render: (id) => {\r\n                return `<button data-id=\"${id}\" class=\"btn-mini btn-danger\">${lpg.del}</button> `;\r\n            },\r\n        },\r\n    ],\r\n});\r\n\r\n\r\n//del\r\ntb.tbody.on('click', '.btn-danger', function () {\r\n    let btn = $(this), msgId = btn.data('id');\r\n\r\n    opg.danger(`${lpg.del} [<b>${msgId}</b>] ? `, function () {\r\n        opg.api.delMsg({msgId}, () => tb.update());\r\n    }, {\r\n        title: `${lpg.please}${lpg.confirm}`,\r\n    });\r\n});"]}