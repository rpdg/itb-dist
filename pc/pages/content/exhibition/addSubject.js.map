{"version":3,"sources":["/pages/content/exhibition/addSubject.ts"],"names":[],"mappings":"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","file":"addSubject.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport PopUp from 'ts/ui/Popup';\r\nimport {Languages} from 'ts/util/Languages';\r\n\r\nconst lpg = Languages.package;\r\nconsole.log('Languages:', Languages);\r\n\r\nopg.api({\r\n\t'addSubject!post': 'mediaexhibtion/AddMediaExhibtionInfoContent',\r\n\t'updateSubject!post': 'mediaexhibtion/UpMediaExhibtionInfoContent',\r\n\tgetSubject: 'mediaexhibtion/GetMediaExhibtionInfoContentById',\r\n\t'upload!UPLOAD': 'upload/files',\r\n});\r\n\r\nconst mediaExhibtionInfoId = opg.request['id'];\r\nconst subjectId = opg.request['subId'];\r\n\r\nlet fileName: string;\r\nlet imgUrl: string;\r\nlet editor: UEditor;\r\nlet editorWrap = $(`<script type=\"text/plain\" id=\"myEditor1\"></script>`);\r\n\r\nlet format = {\r\n\t0: lpg.pureText,\r\n\t1: lpg.picture,\r\n\t2: lpg.link,\r\n\t3: lpg.richText,\r\n\t4: lpg.attachment,\r\n};\r\nlet formatType;\r\n\r\n\r\nlet panel = $('#panel');\r\n\r\nlet selType = $('#selType').on('change', function () {\r\n\r\n\tif (editor) {\r\n\t\teditor.destroy();\r\n\t\teditor = null;\r\n\t\tlocation.reload(true);\r\n\t}\r\n\r\n\tformatType = ~~selType.val();\r\n\tswitch (formatType) {\r\n\t\tcase 0:\r\n\t\t\tpanel.html(`<textarea style=\"width: 460px; height: 230px;\"></textarea>`);\r\n\t\t\tbreak;\r\n\t\tcase 1:\r\n\t\t\tlet btn = $(`<button class=\"btn-mini btn-warning\">upload</button>`);\r\n\t\t\tlet form = $(`<form><input name=\"file\" type=\"file\" accept=\"image/jpg,image/jpeg,image/png\"></form>`);\r\n\t\t\tlet p = $('<p></p>');\r\n\t\t\tpanel.empty().append(form).append(btn).append(p);\r\n\t\t\tbtn.one('click', function () {\r\n\t\t\t\tlet formData = new FormData(form[0] as HTMLFormElement);\r\n\t\t\t\topg.api.upload(formData, function (data) {\r\n\t\t\t\t\tp.html(`<img src=\"${data[0].downloadLink}\" style=\"max-height: 100px;\"/>`);\r\n\t\t\t\t\timgUrl = data[0].downloadLink;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tcase 2:\r\n\t\t\tpanel.html(`<form>\r\n\t\t\t\t\t\t<input name=\"text\" type=\"text\" placeholder=\"${lpg.linkText}\" style=\"width: 100%;\"/>\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t<input name=\"url\" type=\"text\" placeholder=\"${lpg.linkHref}\" style=\"width: 100%;margin-top: 0.5em;\"/>\r\n\t\t\t\t</form>`);\r\n\t\t\tbreak;\r\n\t\tcase 3:\r\n\t\t\t//else{\r\n\t\t\tpanel.empty().append(editorWrap);\r\n\t\t\teditor = UE.getEditor('myEditor1', {\r\n\t\t\t\t//这里可以选择自己需要的工具按钮名称,此处仅选择如下五个\r\n\t\t\t\ttoolbars: [['FullScreen', 'Source', 'Undo', 'Redo', 'Bold', 'Italic', 'Underline', '|', 'forecolor', 'backcolor']],\r\n\t\t\t\t//focus时自动清空初始化时的内容\r\n\t\t\t\tautoClearinitialContent: true,\r\n\t\t\t\t//关闭字数统计\r\n\t\t\t\twordCount: false,\r\n\t\t\t\t//关闭elementPath\r\n\t\t\t\telementPathEnabled: false,\r\n\t\t\t\t//默认的编辑区域高度\r\n\t\t\t\tinitialFrameHeight: 230,\r\n\t\t\t\tlang: Languages.current === 'cn' ? 'zh-cn' : 'en', //语言\r\n\t\t\t});\r\n\t\t\t//}\r\n\r\n\r\n\t\t\tbreak;\r\n\t\tcase 4:\r\n\t\t\tlet btn2 = $(`<button class=\"btn-mini btn-warning\">upload</button>`);\r\n\t\t\tlet form2 = $(`<form><input name=\"file\" type=\"file\" accept=\"*/*\"></form>`);\r\n\t\t\tlet p2 = $('<p></p>');\r\n\t\t\tpanel.empty().append(form2).append(btn2).append(p2);\r\n\t\t\tbtn2.one('click', function () {\r\n\t\t\t\tlet formData2 = new FormData(form2[0] as HTMLFormElement);\r\n\t\t\t\topg.api.upload(formData2, function (data) {\r\n\t\t\t\t\tlet fileFullName = form2.find('input').val();\r\n\t\t\t\t\tfileName = fileFullName.substr(fileFullName.lastIndexOf('\\\\') + 1);\r\n\t\t\t\t\timgUrl = data[0].downloadLink;\r\n\t\t\t\t\tp2.html(`<a href=\"${data[0].downloadLink}\">${fileName}</a>`);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tpanel.empty();\r\n\t}\r\n});\r\n\r\n\r\nif (subjectId) {\r\n\topg.api.getSubject({id : subjectId} , (data)=>{\r\n\t\t//debugger;\r\n\t\t$('#lbFormatType').jsonToFields(data[0]);\r\n\t\tselType.trigger('change').prop('disabled' , true);\r\n\t});\r\n}\r\n\r\n\r\nwindow['doSave'] = function (pop: PopUp, listSubjects: Function) {\r\n\tlet content;\r\n\tswitch (formatType) {\r\n\t\tcase 0 :\r\n\t\t\tcontent = panel.find('textarea').eq(0).val();\r\n\t\t\tbreak;\r\n\t\tcase 1 :\r\n\t\t\tcontent = `<img src=\"${imgUrl}\" style=\"max-height: 100px;\"/>`;\r\n\t\t\tbreak;\r\n\t\tcase 2 :\r\n\t\t\tlet txt, url;\r\n\t\t\tpanel.find('input').each((i, ele) => {\r\n\t\t\t\tlet val = (ele as HTMLInputElement).value;\r\n\t\t\t\tif (!val) {\r\n\t\t\t\t\treturn opg.warn(lpg.nullInputWarn);\r\n\t\t\t\t}\r\n\t\t\t\tif (i === 0)\r\n\t\t\t\t\ttxt = val;\r\n\t\t\t\telse\r\n\t\t\t\t\turl = val;\r\n\t\t\t});\r\n\t\t\tcontent = `<a href=\"${url}\">${txt}</a>`;\r\n\t\t\tbreak;\r\n\t\tcase 3 :\r\n\t\t\tcontent = editor.getContent();\r\n\t\t\tbreak;\r\n\t\tcase 4 :\r\n\t\t\tcontent = `<a href=\"${imgUrl}\">${fileName}</a>`;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\topg.warn(lpg.plsSelect);\r\n\t\t\treturn;\r\n\t}\r\n\r\n\tif (!content) {\r\n\t\topg.warn(lpg.nullInputWarn);\r\n\t}\r\n\telse {\r\n\r\n\t\tif (subjectId) {\r\n\t\t\topg.api.updateSubject({content: content, id: subjectId}, data => {\r\n\t\t\t\tlistSubjects();\r\n\t\t\t\tpop.close();\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet param = {formatType, content, mediaExhibtionInfoId};\r\n\t\t\tconsole.log(param);\r\n\r\n\t\t\topg.api.addSubject(param,  (data) => {\r\n\t\t\t\t//ulSubjects.append(`<li>${content}</li>`);\r\n\t\t\t\tlistSubjects();\r\n\t\t\t\tpop.close();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn true;\r\n\r\n};"]}