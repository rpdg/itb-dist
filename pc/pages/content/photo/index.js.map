{"version":3,"sources":["/pages/content/photo/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport {Languages} from 'ts/util/Languages';\r\nimport {url} from 'ts/util/utils';\r\nimport {store} from \"ts/util/store\";\r\n\r\nopg.api({\r\n\tgetTypes: 'phototype/getallphototypes',\r\n\t'addType!POST': 'phototype/AddPhotoType',\r\n\t'editType!POST': 'phototype/UpPhotoType',\r\n\tdelType: 'phototype/DelPhotoType',\r\n\tgetPhotosByTypeId: 'photo/GetPhotosByTypeId',\r\n\tdelPhotosByTypeId: 'photo/DelPhotosByTypeId',\r\n\t'delPhotosByIds!POST': 'photo/DelPhotosByIds',\r\n});\r\n\r\nconst lpg = Languages.package;\r\nconst permission = store.get('permission');\r\n\r\nlet treeName = 'photoTypes';\r\nlet tree = opg('#tree').tree({\r\n\tapi: opg.api.getTypes,\r\n\tname: treeName,\r\n\troot: `<label><input type=\"radio\" name=\"tree_${treeName}Rd\" value=\"0\" checked> ${lpg.root}</label>`,\r\n\tcmd: 'checkOne',\r\n\tchildSrc: 'childPhotoTypes',\r\n\t//onCreate:removeRadioBox,\r\n\t//onUpdate:removeRadioBox,\r\n});\r\ntree.jq.on('change', ':radio', function () {\r\n\tlet elem = $(this), id = elem.val(), deal = elem.prop('checked');\r\n\t//console.warn('deal' , this);\r\n\tif (deal) {\r\n\t\tcurrentCategoryId = id;\r\n\t\tshowPhotos(id);\r\n\t}\r\n});\r\n\r\nlet ul = $('#photos');\r\nlet currentCategoryId = 0;\r\n\r\nfunction showPhotos(typeid) {\r\n\topg.api.getPhotosByTypeId({typeid}, data => {\r\n\t\tul.bindList({\r\n\t\t\tlist: data,\r\n\t\t\ttemplate: '<li><img src=\"${url}\" alt=\"${title}\"><p><label><input type=\"checkbox\" name=\"photo\" value=\"${id}\"> ${title}</label></p></li>'\r\n\t\t})\r\n\t})\r\n}\r\n\r\nshowPhotos(currentCategoryId);\r\n\r\n\r\n//防止在第二层添加节点\r\n/*function removeRadioBox() {\r\n\ttree.jq.find(':radio').each((i, elem) => {\r\n\t\tlet sp = $(elem).closest('span');\r\n\t\tif (~~sp.data('depth') === 1) {\r\n\t\t\telem.remove();\r\n\t\t}\r\n\t})\r\n}*/\r\n\r\n\r\nif (permission.PhotoTypeManagment) {\r\n\t$('#pButton').show();\r\n\r\n\t// add category\r\n\t$('#btnAddType').click(function () {\r\n\r\n\t\tlet checkedRadio = tree.jq.find(':radio:checked');\r\n\t\tlet sp = checkedRadio.closest('span');\r\n\t\tif (~~sp.data('depth') === 1) {\r\n\t\t\treturn top.opg.warn(lpg.addCategoryWarn);\r\n\t\t}\r\n\r\n\t\tlet nameInput = $('<input type=\"text\" name=\"name\">');\r\n\t\tlet pop = top.opg.confirm($(`<div style=\"padding: 20px;\">${lpg.categoryName}: </div>`).append(nameInput), function () {\r\n\t\t\tlet name = nameInput.val();\r\n\t\t\tif (name) {\r\n\t\t\t\tlet parentid = checkedRadio.val();\r\n\t\t\t\topg.api.addType({parentid, name}, () => {\r\n\t\t\t\t\ttree.update();\r\n\t\t\t\t\tpop.close();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}, {\r\n\t\t\ttitle: lpg.addCategory,\r\n\t\t\twidth: 500,\r\n\t\t\theight: 200,\r\n\t\t})\r\n\t});\r\n\r\n\r\n\t// edit category\r\n\t$('#btnEdit').click(function () {\r\n\r\n\t\tlet checkedRadio = tree.jq.find(':radio:checked');\r\n\t\tlet id = ~~checkedRadio.val();\r\n\t\tif (!id) {\r\n\t\t\treturn top.opg.warn(lpg.editCategoryWarn);\r\n\t\t}\r\n\t\tlet lb = checkedRadio.closest('label');\r\n\r\n\t\tlet nameInput = $(`<input type=\"text\" name=\"name\" value=\"${lb.text()}\">`);\r\n\t\tlet pop = top.opg.confirm($(`<div style=\"padding: 20px;\">${lpg.categoryName}: </div>`).append(nameInput), function () {\r\n\t\t\tlet name = nameInput.val();\r\n\t\t\tif (name) {\r\n\r\n\t\t\t\tlet parentid = lb.closest('ul').closest('li').data('id');\r\n\t\t\t\topg.api.editType({parentid, name, id}, function () {\r\n\t\t\t\t\ttree.update();\r\n\t\t\t\t\tpop.close();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}, {\r\n\t\t\ttitle: lpg.editCategory,\r\n\t\t\twidth: 500,\r\n\t\t\theight: 200,\r\n\t\t})\r\n\t});\r\n\r\n\t// delete category\r\n\t$('#btnDelType').click(function () {\r\n\r\n\t\tlet pop = top.opg.confirm(lpg.deleteCategoryWarn, function () {\r\n\t\t\tlet id = $(`:radio[name=tree_${treeName}Rd]:checked`).val();\r\n\t\t\topg.api.delType({id}, function () {\r\n\t\t\t\ttree.update();\r\n\t\t\t\tpop.close();\r\n\t\t\t})\r\n\t\t}, {});\r\n\r\n\t});\r\n\r\n}\r\n\r\n\r\n//\r\nif (permission.PhotoOperation) {\r\n\t$('#photoManage').show();\r\n\r\n\tconst infoPage = __uri('/pages/content/photo/add.html');\r\n\r\n\t$('#btnAdd').click(function () {\r\n\t\tlet src = url.setParam(infoPage, {typeId: currentCategoryId});\r\n\t\tlet pop = opg.popTop(`<iframe src=\"${src}\" />`, {\r\n\t\t\ttitle: `${lpg.add}`,\r\n\t\t\tbtnMax: true,\r\n\t\t\twidth: 800,\r\n\t\t\theight: 400,\r\n\t\t\tbuttons: {\r\n\t\t\t\tsave: {\r\n\t\t\t\t\tclassName: 'btn-success',\r\n\t\t\t\t\ttext: lpg.save,\r\n\t\t\t\t\tonClick: function (i, ifr) {\r\n\t\t\t\t\t\tifr.save(pop);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcancel: lpg.cancel\r\n\t\t\t},\r\n\t\t\tonClose: function () {\r\n\t\t\t\tshowPhotos(currentCategoryId);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$('#btnDeleteSelected').click(function () {\r\n\t\tlet ids = [];\r\n\t\t$(':checkbox[name=photo]:checked').each((i, elem) => {\r\n\t\t\tids.push(~~(elem as HTMLInputElement).value);\r\n\t\t});\r\n\t\tif (ids.length) {\r\n\t\t\ttop.opg.confirm(lpg.deleteSelected, function () {\r\n\t\t\t\topg.api.delPhotosByIds(ids, () => {\r\n\t\t\t\t\tshowPhotos(currentCategoryId);\r\n\t\t\t\t});\r\n\r\n\t\t\t}, {\r\n\t\t\t\ttitle: lpg.plsConfirm\r\n\t\t\t})\r\n\t\t}\r\n\t});\r\n\t$('#btnDeleteAll').click(function () {\r\n\t\ttop.opg.confirm(lpg.deleteAll, function () {\r\n\t\t\topg.api.delPhotosByTypeId({typeid: currentCategoryId}, () => {\r\n\t\t\t\tshowPhotos(currentCategoryId);\r\n\t\t\t});\r\n\t\t}, {\r\n\t\t\ttitle: lpg.plsConfirm\r\n\t\t})\r\n\t});\r\n}\r\n"]}