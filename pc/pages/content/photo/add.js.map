{"version":3,"sources":["/pages/content/photo/add.ts"],"names":[],"mappings":";;;;AAAA,oCAA4B;AAE5B,+CAA4C;AAE5C,IAAM,GAAG,GAAG,qBAAS,CAAC,OAAO,CAAC;AAC9B,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,qBAAS,CAAC,CAAC;AAQrC,gBAAG,CAAC,GAAG,CAAC;IACP,eAAe,EAAE,cAAc;IAC/B,gBAAgB,EAAE,iBAAiB;IACnC,iBAAiB,EAAE,kBAAkB;IACrC,UAAU,EAAE,yBAAyB;CACrC,CAAC,CAAC;AAEH,IAAM,MAAM,GAAW,CAAC,CAAC,gBAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/C,IAAI,MAAM,GAAY,EAAE,CAAC;AACzB,IAAI,OAAO,GAAwC,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;AACpF,IAAI,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;AAC3B,QAAQ,CAAC,EAAE,CAAC,OAAO,EAAE,aAAa,EAAE;IACnC,IAAI,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACjD,gBAAG,CAAC,GAAG,CAAC,UAAU,CAAC,EAAC,QAAQ,YAAC,EAAE;QAC9B,GAAG,CAAC,MAAM,EAAE,CAAC,MAAM,EAAE,CAAC;QACtB,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;QACf,MAAM,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,CAAC;YACvB,IAAI,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;gBACrC,KAAK,GAAG,CAAC,CAAC;gBACV,OAAO,IAAI,CAAC;aACZ;QACF,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QACxB;;;aAGK;IACN,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE;IACvB,IAAI,KAAK,GAAa,OAAO,CAAC,KAAK,CAAC;IACpC,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;QACrB,IAAI,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;QAC9B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACtC,QAAQ,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;SACvC;QACD,gBAAG,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE,UAAU,IAAI;YACtC,OAAO,CAAC,KAAK,GAAG,EAAE,CAAC;YAEnB,QAAQ,CAAC,QAAQ,CAAC;gBACjB,IAAI,EAAE,IAAI;gBACV,QAAQ,EAAE,2GAA2G,GAAG,GAAG,CAAC,GAAG,GAAG,iBAAiB;gBACnJ,IAAI,EAAE,QAAQ;aACd,CAAC,CAAC;YAEH,IAAI,CAAC,GAAG,CAAC,UAAC,GAAG,EAAE,CAAC;gBACf,MAAM,CAAC,IAAI,CAAC;oBACX,MAAM;oBACN,GAAG,EAAE,GAAG,CAAC,YAAY;iBACrB,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;KACH;AACF,CAAC,CAAC,CAAC;AAEH,IAAI,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;AAE3B,gBAAG,CAAC,GAAG,CAAC,UAAU,CAAC,cAAI;IACtB,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,KAAK,IAAI,GAAG,IAAI,IAAI,EAAE;QACrB,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,CAAC;YACzB,IAAI,CAAC,IAAI,CAAC,EAAC,IAAI,QAAC,CAAC,CAAC;QACnB,CAAC,CAAC,CAAC;KACH;IAED,IAAI,GAAG,GAAG,CAAC,CAAC,oCAAoC,CAAC,CAAC;IAElD,IAAI,OAAO,GAAG,gBAAG,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC;QAC/B,IAAI,EAAG,IAAI;QACX,IAAI,EAAG,WAAW;KAClB,CAAC,CAAC;IAEH,mBAAmB;IAEnB,CAAC,CAAC,cAAc,CAAC,CAAC,KAAK,CAAC;QACvB,gBAAG,CAAC,OAAO,CAAC,GAAG,EAAE;YAChB,IAAI,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAC5B,IAAI,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC/B,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;YAC9B,KAAK,CAAC,GAAG,CAAC,UAAC,IAAI;gBACd,IAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAG,CAAC,CAAC,EAAC;oBAC5B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iBAClB;YACF,CAAC,CAAC,CAAC;YACH,IAAG,MAAM,CAAC,CAAC,CAAC,KAAG,EAAE;gBAChB,MAAM,CAAC,MAAM,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;YACpB,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QAChC,CAAC,EAAE,EAAE,CAAC,CAAC;IACR,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,CAAC,GAAG,UAAU,GAAU;IACpC,IAAI,GAAG,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;IACzB,IAAI,GAAG,EAAE;QACR,MAAM,CAAC,OAAO,CAAC,aAAG;YACjB,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC;QACjB,CAAC,CAAC,CAAC;KACH;IAED,gBAAG,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,EAAE;QACzB,GAAG,CAAC,KAAK,EAAE,CAAC;IACb,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC","file":"add.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport PopUp from 'ts/ui/Popup';\r\nimport {Languages} from 'ts/util/Languages';\r\n\r\nconst lpg = Languages.package;\r\nconsole.log('Languages:', Languages);\r\n\r\ninterface Photo {\r\n\ttitle?: string;\r\n\ttypeId: number;\r\n\turl: string;\r\n}\r\n\r\nopg.api({\r\n\t'upload!UPLOAD': 'upload/files',\r\n\t'addPhotos!post': 'photo/AddPhotos',\r\n\t'deleteFile!post': 'file/deltempfile',\r\n\tgetAllTags: 'photo/GetAllPhotoTitles',\r\n});\r\n\r\nconst typeId: number = ~~opg.request['typeId'];\r\nlet imgArr: Photo[] = [];\r\nlet fileIpt: HTMLInputElement = <HTMLInputElement> document.getElementById('files');\r\nlet imgPanel = $('#panel');\r\nimgPanel.on('click', '.btn-danger', function () {\r\n\tlet btn = $(this), fileName = btn.data('target');\r\n\topg.api.deleteFile({fileName}, () => {\r\n\t\tbtn.parent().remove();\r\n\t\tlet index = -1;\r\n\t\timgArr.forEach((photo, i) => {\r\n\t\t\tif (photo.url.indexOf(fileName) > -1) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\timgArr.splice(index, 1);\r\n\t\t/*imgPanel.bindList({\r\n\t\t\tlist: imgArr,\r\n\t\t\ttemplate: '<div><img src=\"${downloadLink}\"><button class=\"btn-mini btn-danger\" data-target=\"${storageFileName}\">'+lpg.del+'</button></div>',\r\n\t\t});*/\r\n\t});\r\n});\r\n\r\n$(fileIpt).on('change', function () {\r\n\tlet files: FileList = fileIpt.files;\r\n\tif (files.length > 0) {\r\n\t\tlet formData = new FormData();\r\n\t\tfor (let i = 0; i < files.length; i++) {\r\n\t\t\tformData.append('file_' + i, files[i]);\r\n\t\t}\r\n\t\topg.api.upload(formData, function (data) {\r\n\t\t\tfileIpt.value = '';\r\n\r\n\t\t\timgPanel.bindList({\r\n\t\t\t\tlist: data,\r\n\t\t\t\ttemplate: '<div><img src=\"${downloadLink}\"><br><button class=\"btn-mini btn-danger\" data-target=\"${storageFileName}\">' + lpg.del + '</button></div>',\r\n\t\t\t\tmode: 'append',\r\n\t\t\t});\r\n\r\n\t\t\tdata.map((val, i) => {\r\n\t\t\t\timgArr.push({\r\n\t\t\t\t\ttypeId,\r\n\t\t\t\t\turl: val.downloadLink,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n});\r\n\r\nlet iptTitle = $('#title');\r\n\r\nopg.api.getAllTags(data => {\r\n\tlet tags = [];\r\n\tfor (let key in data) {\r\n\t\tdata[key].forEach((name, i) => {\r\n\t\t\ttags.push({name});\r\n\t\t});\r\n\t}\r\n\r\n\tlet div = $('<div style=\"padding: 20px;\"></div>');\r\n\r\n\tlet chkTags = opg(div).checkBox({\r\n\t\tdata : tags,\r\n\t\tname : 'photoTags'\r\n\t});\r\n\r\n\t//console.log(div);\r\n\r\n\t$('#btnShowTags').click(function () {\r\n\t\topg.confirm(div, function () {\r\n\t\t\tlet tagVal = iptTitle.val();\r\n\t\t\tlet tagArr = tagVal.split(',');\r\n\t\t\tlet chked = chkTags.getText();\r\n\t\t\tchked.map((name)=>{\r\n\t\t\t\tif(tagArr.indexOf(name)===-1){\r\n\t\t\t\t\ttagArr.push(name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif(tagArr[0]==='')\r\n\t\t\t\ttagArr.splice(0,1);\r\n\t\t\tiptTitle.val(tagArr.join(','));\r\n\t\t}, {});\r\n\t});\r\n});\r\n\r\nwindow['save'] = function (pop: PopUp) {\r\n\tlet tag = iptTitle.val();\r\n\tif (tag) {\r\n\t\timgArr.forEach(img => {\r\n\t\t\timg.title = tag;\r\n\t\t});\r\n\t}\r\n\r\n\topg.api.addPhotos(imgArr, () => {\r\n\t\tpop.close();\r\n\t});\r\n};"]}