{"version":3,"sources":["/pages/content/activity/subject.ts"],"names":[],"mappings":"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","file":"subject.js","sourcesContent":["import opg from 'ts/opg';\r\nimport {Languages} from 'ts/util/Languages';\r\nimport {string} from 'ts/util/utils';\r\nimport UserManage from './UserManage';\r\nimport GuestManage from './GuestManage';\r\nimport Panel from 'ts/ui/Panel';\r\nimport {Cache} from 'ts/util/store';\r\n\r\n\r\nconst activityId: number = ~~opg.request['activityId'];\r\nlet subjectId: number = ~~opg.request['subjectId'];\r\n\r\nconst cache = Cache.getInstance();\r\nlet row = cache.get('rowSub');\r\nconsole.log(row);\r\n\r\n\r\nopg.api({\r\n\t'addSubjectMain!post': 'activity/AddActivityContent',\r\n\t'updateSubjectMain!post': 'activity/UpActivityContent',\r\n});\r\n\r\nconst lng = Languages.package;\r\n\r\n\r\nconst form = $('#tbMain');\r\nlet panel: Panel = opg.wrapPanel(form, {\r\n\ttitle: `${lng.subjectBody}`,\r\n\tbtnSearchText: `<i class=\"ico-find\"></i> ${lng.save}`,\r\n\tbtnSearchClick: function () {\r\n\t\tlet param = form.fieldsToJson({\r\n\t\t\ttitle: {\r\n\t\t\t\tname: lng.title,\r\n\t\t\t\trequire: true,\r\n\t\t\t},\r\n\t\t\ttime0: {\r\n\t\t\t\tname: lng.timeFrom,\r\n\t\t\t\trequire: true,\r\n\t\t\t},\r\n\t\t\ttime1: {\r\n\t\t\t\tname: lng.timeTo,\r\n\t\t\t\trequire: true,\r\n\t\t\t},\r\n\t\t});\r\n\t\tif (param) {\r\n\t\t\tparam.activityId = activityId;\r\n\t\t\tparam.occupyTime = param.occupyTime ? (param.occupyTime.join ? param.occupyTime.join(',') : param.occupyTime) : '';\r\n\t\t\tparam.time = `${param.time0}-${param.time1}`;\r\n\t\t\tdelete param.time0;\r\n\t\t\tdelete param.time1;\r\n\r\n\t\t\tif (subjectId) {\r\n\t\t\t\tparam.id = subjectId;\r\n\t\t\t\topg.api.updateSubjectMain(param , ()=>{\r\n\t\t\t\t\t$.extend(row , param);\r\n\t\t\t\t\tcache.set('rowSub' , row);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\topg.api.addSubjectMain(param, (data) => {\r\n\t\t\t\t\tsubjectId = data;\r\n\t\t\t\t\tparam.id = subjectId;\r\n\r\n\t\t\t\t\t$.extend(row , param);\r\n\t\t\t\t\tcache.set('rowSub' , row);\r\n\r\n\t\t\t\t\tnew GuestManage(subjectId);\r\n\t\t\t\t\tnew UserManage(subjectId);\r\n\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t},\r\n});\r\n\r\n\r\njQuery.datetimepicker.setLocale(Languages.current);\r\n$('#timeFrom,#timeTo').each(function (i, elem) {\r\n\t$(elem).datetimepicker({\r\n\t\tdatepicker: false,\r\n\t\t//closeOnDateSelect: true,\r\n\t\tformat: 'H:i',\r\n\t\tstep: 10,\r\n\t});\r\n});\r\n\r\nlet optArr = [];\r\nfor (let i = 7, l = 20, s = 0, step = 30; i < l;) {\r\n\tlet curH = string.padLeft(i, 2);\r\n\tlet curS = string.padLeft(s, 2);\r\n\ts += step;\r\n\tlet h = ~~(s / 60);\r\n\tif (h > 0) {\r\n\t\ti += h;\r\n\t\ts %= 60;\r\n\t}\r\n\tlet nextH = string.padLeft(i, 2);\r\n\tlet nextS = string.padLeft(s, 2);\r\n\tif (i < l) {\r\n\t\tlet opt = `${curH}:${curS}-${nextH}:${nextS}`;\r\n\t\t//console.log(opt);\r\n\t\toptArr.push(`<option value=\"${opt}\">${opt}</option>`);\r\n\t}\r\n}\r\n\r\nlet selOccupyTime = $('#occupyTime').html(optArr.join(''));\r\n\r\nif (subjectId) {\r\n\tlet t = row.time?row.time.split('-'):[];\r\n\trow.time0 = t[0];\r\n\trow.time1 = t[1];\r\n\tform.jsonToFields(row);\r\n\r\n\tlet occ = row.occupytime?row.occupytime.split(','):[];\r\n\tlet opts = selOccupyTime.find('option');\r\n\tocc.map((v,i)=>{\r\n\t\topts.each((j, elem)=>{\r\n\t\t\tlet opt = elem as HTMLOptionElement;\r\n\t\t\tconsole.log(opt , v);\r\n\t\t\tif(opt.value === v){\r\n\t\t\t\t$(opt).prop('selected' , true);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t})\r\n\t});\r\n\r\n\r\n\tnew GuestManage(subjectId);\r\n\tnew UserManage(subjectId);\r\n}\r\n\r\n\r\n\r\n"]}