{"version":3,"sources":["/pages/content/activity/UserManage.ts"],"names":[],"mappings":";;;;AAAA,8BAAyB;AAIzB,+CAA4C;AAC5C,uCAAkC;AAElC,IAAM,GAAG,GAAG,qBAAS,CAAC,OAAO,CAAC;AAE9B,IAAM,aAAa,GAAG;IACrB,IAAI,EAAE,EAAE;IACR,CAAC,EAAE,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC;IACvB,CAAC,EAAE,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC;CACvB,CAAC;AAEF,IAAM,cAAc,GAAG;IACtB,IAAI,EAAE,EAAE;IACR,CAAC,EAAE,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;IACxB,CAAC,EAAE,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;CACxB,CAAC;AAGF,IAAM,IAAI,GAAG,KAAK,CAAC,gBAAgB,CAAC,CAAC;AAErC;IAKC,oBAAY,SAAiB;QAA7B,iBAwEC;QArEA,aAAG,CAAC,GAAG,CAAC;YACP,OAAO,EAAE,oCAAoC;YAC7C,cAAc,EAAE,iCAAiC;YACjD,cAAc,EAAE,iCAAiC;SACjD,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAE3B,IAAI,GAAG,GAAG,CAAC,CAAC,iBAAiB,CAAC,CAAC;QAE/B,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAErB,IAAI,CAAC,EAAE,GAAG,aAAG,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC;YACxB,GAAG,EAAE,aAAG,CAAC,GAAG,CAAC,OAAO;YACpB,KAAK,EAAE;gBACN,iBAAiB,EAAE,SAAS;aAC5B;YACD,QAAQ,EAAE;gBACT,KAAK,EAAE,GAAG,CAAC,IAAI;gBACf,OAAO,EAAE;oBACR,EAAC,EAAE,EAAE,QAAQ,EAAE,SAAS,EAAE,YAAY,EAAE,IAAI,EAAE,sCAAkC,GAAG,CAAC,GAAK,EAAC;iBAC1F;aACD;YACD,OAAO,EAAE;gBACR;oBACC,IAAI,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,GAAG;oBAC9B,GAAG,EAAE,WAAW;oBAChB,MAAM,EAAE,UAAC,SAAS,EAAE,CAAC,EAAE,GAAG;wBACzB,MAAM,CAAC,CAAG,SAAS,IAAE,EAAE,WAAI,GAAG,CAAC,QAAQ,IAAE,EAAE,CAAE,CAAC;oBAC/C,CAAC;iBACD;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,GAAG;oBAC9B,GAAG,EAAE,UAAU;iBACf;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,aAAa;oBACvB,GAAG,EAAE,UAAU;iBACf;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,SAAS;oBACnB,GAAG,EAAE,QAAQ;oBACb,MAAM,EAAE,gBAAM,IAAI,oBAAa,CAAC,MAAM,CAAC,EAArB,CAAqB;iBACvC;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,UAAU;oBACpB,GAAG,EAAE,QAAQ;oBACb,MAAM,EAAE,gBAAM,IAAI,qBAAc,CAAC,MAAM,CAAC,EAAtB,CAAsB;iBACxC;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,OAAO;oBACjB,GAAG,EAAE,SAAS;oBACd,KAAK,EAAE,GAAG;oBACV,MAAM,EAAE,YAAE,IAAI,8BAAoB,EAAE,gDAAwC,GAAG,CAAC,GAAG,cAAW,EAAhF,CAAgF;iBAC9F;aACD;YACD,UAAU,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,KAAK;QACL,CAAC,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;YAClB,KAAI,CAAC,OAAO,EAAE,CAAC;QAChB,CAAC,CAAC,CAAC;QAEH,QAAQ;QACR,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,UAAC,CAAC;YACtC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC7C,KAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,4BAAO,GAAP;QACC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,GAAG,GAAG,WAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAC,SAAS,EAAE,IAAI,CAAC,SAAS,EAAC,CAAC,CAAC;QAC1D,IAAI,GAAG,GAAU,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,mBAAgB,GAAG,iBAAa,EAAE,UAAU,CAAC,EAAE,GAAG;YAClF,GAAG,CAAC,IAAI,CAAC,GAAG,EAAG,IAAI,CAAC,EAAE,CAAC,CAAC;YACxB,MAAM,CAAC,IAAI,CAAC;QACb,CAAC,EAAE;YACF,KAAK,EAAE,GAAG,CAAC,OAAO;YAClB,MAAM,EAAE,IAAI;YACZ,KAAK,EAAE,GAAG;YACV,MAAM,EAAE,GAAG;SACX,CAAC,CAAC;IAEJ,CAAC;IAED,+BAAU,GAAV,UAAW,EAAU;QACpB,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,GAAG,GAAU,aAAG,CAAC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE;YAEpD,aAAG,CAAC,GAAG,CAAC,OAAO,CAAC,EAAC,iBAAiB,EAAE,IAAI,CAAC,SAAS,EAAE,MAAM,EAAE,EAAE,EAAC,EAAE,cAAI;gBACpE,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC;gBACjB,GAAG,CAAC,KAAK,EAAE,CAAC;YACb,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,IAAI,CAAC;QACb,CAAC,CAAC,CAAC;IACJ,CAAC;IACF,iBAAC;AAAD,CAAC","file":"UserManage.js","sourcesContent":["import opg from 'ts/opg';\r\nimport Table from 'ts/ui/Table';\r\nimport Popup from 'ts/ui/Popup';\r\n\r\nimport {Languages} from 'ts/util/Languages';\r\nimport {url} from 'ts/util/utils';\r\n\r\nconst lng = Languages.package;\r\n\r\nconst isInvitedHash = {\r\n\t'-1': '',\r\n\t0: lng.isInvitedHash[0],\r\n\t1: lng.isInvitedHash[1],\r\n};\r\n\r\nconst isAcceptedHash = {\r\n\t'-1': '',\r\n\t0: lng.isAcceptedHash[0],\r\n\t1: lng.isAcceptedHash[1],\r\n};\r\n\r\n\r\nconst page = __uri('./addUser.html');\r\n\r\nexport default class UserManage {\r\n\r\n\tprivate tb: Table;\r\n\tprivate subjectId: number;\r\n\r\n\tconstructor(subjectId: number) {\r\n\r\n\r\n\t\topg.api({\r\n\t\t\tgetUser: 'activity/QueryActivityContentUsers',\r\n\t\t\t'addUser!post': 'activity/AddActivityContentUser',\r\n\t\t\t'delUser!post': 'activity/DelActivityContentUser',\r\n\t\t});\r\n\r\n\t\tthis.subjectId = subjectId;\r\n\r\n\t\tlet $tb = $('<table></table>');\r\n\r\n\t\t$tb.appendTo('body');\r\n\r\n\t\tthis.tb = opg($tb).table({\r\n\t\t\tapi: opg.api.getUser,\r\n\t\t\tparam: {\r\n\t\t\t\tactivityContentId: subjectId,\r\n\t\t\t},\r\n\t\t\ttitleBar: {\r\n\t\t\t\ttitle: lng.user,\r\n\t\t\t\tbuttons: [\r\n\t\t\t\t\t{id: 'btnAdd', className: 'btn-create', html: `<i class=\"ico ico-create\"></i> ${lng.add}`},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tcolumns: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.userName, width: 200,\r\n\t\t\t\t\tsrc: 'firstname',\r\n\t\t\t\t\trender: (firstname, i, row) => {\r\n\t\t\t\t\t\treturn `${firstname||''} ${row.lastname||''}`;\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.userRole, width: 150,\r\n\t\t\t\t\tsrc: 'rolename',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.userLoginName,\r\n\t\t\t\t\tsrc: 'username',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.isInvited,\r\n\t\t\t\t\tsrc: 'invite',\r\n\t\t\t\t\trender: invite => isInvitedHash[invite],\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.isAccepted,\r\n\t\t\t\t\tsrc: 'accept',\r\n\t\t\t\t\trender: accept => isAcceptedHash[accept],\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.process,\r\n\t\t\t\t\tsrc: 'user_id',\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\trender: id => `<button data-id=\"${id}\" class=\"btn-mini btn-danger btnDel\">${lng.del}</button>`,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tpagination: true,\r\n\t\t});\r\n\r\n\t\t//add\r\n\t\t$('#btnAdd').click(() => {\r\n\t\t\tthis.addUser();\r\n\t\t});\r\n\r\n\t\t//delete\r\n\t\tthis.tb.tbody.on('click', '.btnDel', (e) => {\r\n\t\t\tlet btn = $(e.target), id = ~~btn.data('id');\r\n\t\t\tthis.deleteUser(id);\r\n\t\t});\r\n\t}\r\n\r\n\taddUser() {\r\n\t\tlet that = this;\r\n\t\tlet src = url.setParam(page, {subjectId: this.subjectId});\r\n\t\tlet pop: Popup = top.opg.confirm(`<iframe src=\"${src}\"></iframe>`, function (i, ifr) {\r\n\t\t\tifr.save(pop , that.tb);\r\n\t\t\treturn true;\r\n\t\t}, {\r\n\t\t\ttitle: lng.addUser,\r\n\t\t\tbtnMax: true,\r\n\t\t\twidth: 800,\r\n\t\t\theight: 530,\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tdeleteUser(id: number) {\r\n\t\tlet that = this;\r\n\t\tlet pop: Popup = opg.confirm(lng.deleteGuestConfirm, function () {\r\n\r\n\t\t\topg.api.delUser({activityContentId: that.subjectId, userId: id}, data => {\r\n\t\t\t\tthat.tb.update();\r\n\t\t\t\tpop.close();\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n}"]}