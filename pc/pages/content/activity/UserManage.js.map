{"version":3,"sources":["/pages/content/activity/UserManage.ts"],"names":[],"mappings":";;;;AAAA,8BAAyB;AAIzB,+CAA4C;AAC5C,uCAAkC;AAElC,IAAM,GAAG,GAAG,qBAAS,CAAC,OAAO,CAAC;AAE9B,IAAM,aAAa,GAAG;IACrB,IAAI,EAAE,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC;IAC7B,CAAC,EAAE,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC;IACvB,CAAC,EAAE,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC;CACvB,CAAC;AAEF,IAAM,cAAc,GAAG;IACtB,IAAI,EAAE,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;IAC5B,CAAC,EAAE,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;IACxB,CAAC,EAAE,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;CACxB,CAAC;AAIF,aAAG,CAAC,GAAG,CAAC;IACP,OAAO,EAAE,oCAAoC;IAC7C,cAAc,EAAE,iCAAiC;IACjD,cAAc,EAAE,iCAAiC;IACjD,iBAAiB,EAAE,oCAAoC;IACpD,sBAAsB,EAAE,yCAAyC;IACpE,KAAK,EAAE,kDAAkD;CACzD,CAAC,CAAC;AAGH,IAAM,IAAI,GAAG,KAAK,CAAC,gBAAgB,CAAC,CAAC;AAGrC,IAAM,OAAO,GAAG,CAAC,CAAC,mGACyC,GAAG,CAAC,QAAQ,oEACrB,GAAG,CAAC,OAAO,gCACrD,CAAC,CAAC;AAEV;IAKC,oBAAY,SAAiB;QAA7B,iBAmHC;QAhHA,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAE3B,IAAI,GAAG,GAAG,CAAC,CAAC,iBAAiB,CAAC,CAAC;QAE/B,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAErB,IAAI,CAAC,EAAE,GAAG,aAAG,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC;YACxB,GAAG,EAAE,aAAG,CAAC,GAAG,CAAC,OAAO;YACpB,KAAK,EAAE;gBACN,iBAAiB,EAAE,SAAS;aAC5B;YACD,QAAQ,EAAE;gBACT,KAAK,EAAE,GAAG,CAAC,IAAI;gBACf,OAAO,EAAE;oBACO,EAAC,EAAE,EAAE,UAAU,EAAE,SAAS,EAAE,YAAY,EAAE,IAAI,EAAE,KAAG,GAAG,CAAC,eAAiB,EAAC;oBACzE,EAAC,EAAE,EAAE,QAAQ,EAAE,SAAS,EAAE,YAAY,EAAE,IAAI,EAAE,sCAAkC,GAAG,CAAC,GAAK,EAAC;iBACzG;aACD;YACD,OAAO,EAAE;gBACR;oBACC,IAAI,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,GAAG;oBAC9B,GAAG,EAAE,WAAW;oBAChB,MAAM,EAAE,UAAC,SAAS,EAAE,CAAC,EAAE,GAAG;wBACzB,OAAO,CAAG,SAAS,IAAE,EAAE,WAAI,GAAG,CAAC,QAAQ,IAAE,EAAE,CAAE,CAAC;oBAC/C,CAAC;iBACD;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,GAAG;oBAC9B,GAAG,EAAE,UAAU;iBACf;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,aAAa;oBACvB,GAAG,EAAE,UAAU;iBACf;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,SAAS;oBACnB,GAAG,EAAE,QAAQ;oBACb,KAAK,EAAE,GAAG;oBACV,MAAM,EAAE,UAAC,MAAM,EAAG,CAAC,EAAG,GAAG;wBACxB,OAAO,KAAG,aAAa,CAAC,MAAM,CAAG;oBAClC,CAAC;iBACD;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,UAAU;oBACpB,GAAG,EAAE,QAAQ;oBACb,KAAK,EAAE,GAAG;oBACV,MAAM,EAAG,UAAC,MAAM,EAAG,CAAC,EAAG,GAAG;wBACzB,IAAG,MAAM,IAAI,CAAC,CAAC,EAAC;4BACf,OAAO,mEAA8D,GAAG,CAAC,OAAO,8BAAsB,GAAG,CAAC,KAAK,mGACjD,GAAG,CAAC,OAAO,8BAAsB,GAAG,CAAC,IAAI,cAAW;yBAClH;6BACG;4BACH,OAAO,GAAG,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;yBAClC;oBACF,CAAC;iBACD;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,SAAS;oBACnB,GAAG,EAAE,iBAAiB;iBACtB;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,WAAW;oBACrB,GAAG,EAAE,cAAc;iBACnB;gBACD;oBACC,IAAI,EAAE,GAAG,CAAC,OAAO;oBACjB,GAAG,EAAE,SAAS;oBACd,KAAK,EAAE,GAAG;oBACV,MAAM,EAAE,YAAE;wBACT,OAAO,uCACa,EAAE,gDAAwC,GAAG,CAAC,GAAG,mDACjD,EAAE,iDAAyC,GAAG,CAAC,UAAU,4BAC5E,CAAC;oBACH,CAAC;iBACD;aACD;YACD,UAAU,EAAE,IAAI;SAChB,CAAC,CAAC;QAGH,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,oBAAoB,EAAE;YAC/C,IAAI,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,EAAG,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAG,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAClF,aAAG,CAAC,GAAG,CAAC,KAAK,CAAC,EAAC,iBAAiB,EAAG,SAAS,EAAG,MAAM,UAAG,MAAM,UAAC,EAAE,cAAI;gBACpE,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC;YAClB,CAAC,CAAC,CAAC;QAGJ,CAAC,CAAC,CAAC;QAGH,KAAK;QACL,CAAC,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;YAClB,KAAI,CAAC,OAAO,EAAE,CAAC;QAChB,CAAC,CAAC,CAAC;QAEG,oBAAoB;QACpB,CAAC,CAAC,WAAW,CAAC,CAAC,KAAK,CAAC;YACjB,KAAI,CAAC,YAAY,EAAE,CAAC;QACxB,CAAC,CAAC,CAAC;QAET,QAAQ;QACR,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,UAAC,CAAC;YACtC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC7C,KAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,cAAc;QACd,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,UAAC,CAAC;YACtC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC7C,KAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,iCAAY,GAAZ;QACO,IAAI,IAAI,GAAG,IAAI,CAAC;QAEhB,IAAI,KAAK,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,YAAY,CAAC,EAErC,CAAC,CAAC;QAEH,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACvC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,GAAG,GAAE,KAAK,CAAC,KAAK,GAAG,GAAG,GAAG,KAAK,CAAC,KAAK,GAAG,GAAG,GAAG,KAAK,CAAC,QAAQ,GAAG,GAAG,GAAI,KAAK,CAAC,OAAO,GAAG,GAAG,GAAG,KAAK,CAAC,IAAI,GAAG,GAAG,GAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC3K,UAAU,CAAC;YACP,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,EAAG;gBACtB,IAAI,GAAG,GAAG;oBACN,mBAAmB,EAAE,IAAI,CAAC,SAAS;oBACnC,SAAS,EAAC;wBACN,SAAS,EAAC,CAAC;wBACX,UAAU,EAAE,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE;wBACvC,YAAY,EAAE,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE;qBAC/C;iBACJ,CAAC;gBAEF,aAAG,CAAC,GAAG,CAAC,eAAe,CAAC,GAAG,EAAG,cAAI;oBAC9B,aAAG,CAAC,EAAE,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;oBAC5B,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC;oBAChB,OAAO,CAAC,CAAC,CAAqB,CAAC,KAAK,EAAE,CAAC;gBAC5C,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACP,CAAC,EAAE,IAAI,CAAC,CAAC;IAChB,CAAC;IAED,4BAAO,GAAP,UAAQ,MAAc;QACrB,IAAI,IAAI,GAAG,IAAI,CAAC;QAEV,IAAI,KAAK,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,YAAY,CAAC,EAErC,CAAC,CAAC;QAET,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACjC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,GAAG,GAAE,KAAK,CAAC,KAAK,GAAG,GAAG,GAAG,KAAK,CAAC,KAAK,GAAG,GAAG,GAAG,KAAK,CAAC,QAAQ,GAAG,GAAG,GAAI,KAAK,CAAC,OAAO,GAAG,GAAG,GAAG,KAAK,CAAC,IAAI,GAAE,GAAG,GAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAE1K,UAAU,CAAC;YACP,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,EAAG;gBACtB,IAAI,GAAG,GAAG;oBACN,mBAAmB,EAAE,IAAI,CAAC,SAAS;oBACnC,QAAQ,EAAE,MAAM;oBAChB,SAAS,EAAC;wBACN,SAAS,EAAC,CAAC;wBACX,QAAQ,EAAC,MAAM;wBACf,UAAU,EAAE,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE;wBACvC,YAAY,EAAE,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE;qBAC/C;iBACJ,CAAC;gBAEF,aAAG,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,EAAG,cAAI;oBACzB,aAAG,CAAC,EAAE,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;oBACvB,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC;oBAChB,OAAO,CAAC,CAAC,CAAqB,CAAC,KAAK,EAAE,CAAC;gBAC5C,CAAC,CAAC;YACN,CAAC,CAAC,CAAC;QACP,CAAC,EAAE,IAAI,CAAC,CAAC;IAChB,CAAC;IAED,4BAAO,GAAP;QACC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,GAAG,GAAG,WAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAC,SAAS,EAAE,IAAI,CAAC,SAAS,EAAC,CAAC,CAAC;QAC1D,IAAI,GAAG,GAAU,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,mBAAgB,GAAG,iBAAa,EAAE,UAAU,CAAC,EAAE,GAAG;YAClF,GAAG,CAAC,IAAI,CAAC,GAAG,EAAG,IAAI,CAAC,EAAE,CAAC,CAAC;YACxB,OAAO,IAAI,CAAC;QACb,CAAC,EAAE;YACF,KAAK,EAAE,GAAG,CAAC,OAAO;YAClB,MAAM,EAAE,IAAI;YACZ,KAAK,EAAE,GAAG;YACV,MAAM,EAAE,GAAG;YACX,OAAO,EAAE;gBACR,EAAE,EAAC,GAAG,CAAC,GAAG;gBACV,MAAM,EAAC,GAAG,CAAC,OAAO;aAClB;SACD,CAAC,CAAC;IAEJ,CAAC;IAED,+BAAU,GAAV,UAAW,EAAU;QACpB,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,GAAG,GAAU,aAAG,CAAC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE;YAEpD,aAAG,CAAC,GAAG,CAAC,OAAO,CAAC,EAAC,iBAAiB,EAAE,IAAI,CAAC,SAAS,EAAE,MAAM,EAAE,EAAE,EAAC,EAAE,cAAI;gBACpE,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC;gBACjB,GAAG,CAAC,KAAK,EAAE,CAAC;YACb,CAAC,CAAC,CAAC;YAEH,OAAO,IAAI,CAAC;QACb,CAAC,CAAC,CAAC;IACJ,CAAC;IACF,iBAAC;AAAD,CAAC","file":"UserManage.js","sourcesContent":["import opg from 'ts/opg';\r\nimport Table from 'ts/ui/Table';\r\nimport Popup from 'ts/ui/Popup';\r\n\r\nimport {Languages} from 'ts/util/Languages';\r\nimport {url} from 'ts/util/utils';\r\n\r\nconst lng = Languages.package;\r\n\r\nconst isInvitedHash = {\r\n\t'-1': lng.isInvitedHash['-1'],\r\n\t0: lng.isInvitedHash[0],\r\n\t1: lng.isInvitedHash[1],\r\n};\r\n\r\nconst isAcceptedHash = {\r\n\t'-1': lng.isAcceptedHash[-1],\r\n\t0: lng.isAcceptedHash[0],\r\n\t1: lng.isAcceptedHash[1],\r\n};\r\n\r\n\r\n\r\nopg.api({\r\n\tgetUser: 'activity/QueryActivityContentUsers',\r\n\t'addUser!post': 'activity/AddActivityContentUser',\r\n\t'delUser!post': 'activity/DelActivityContentUser',\r\n\t'sendInvite!post': 'activity/SendActivityContentInivte',\r\n    'sendBatchInvite!post': 'activity/SendBatchActivityContentInivte',\r\n\treply: 'activity/AllowOrDenyActivityContentForUserInBack', // 0是拒绝 1是同意\r\n});\r\n\r\n\r\nconst page = __uri('./addUser.html');\r\n\r\n\r\nconst msgForm = $(`<form style=\"padding: 2em;\">\r\n<p><input type=\"text\" style=\"width: 100%;\"  placeholder=\"${lng.msgTitle}\"></p>\r\n<p><textarea  style=\"width: 100%;\" placeholder=\"${lng.content}\"></textarea></p>\r\n</form>`);\r\n\r\nexport default class UserManage {\r\n\r\n\tprivate tb: Table;\r\n\tprivate subjectId: number;\r\n\r\n\tconstructor(subjectId: number) {\r\n\r\n\r\n\t\tthis.subjectId = subjectId;\r\n\r\n\t\tlet $tb = $('<table></table>');\r\n\r\n\t\t$tb.appendTo('body');\r\n\r\n\t\tthis.tb = opg($tb).table({\r\n\t\t\tapi: opg.api.getUser,\r\n\t\t\tparam: {\r\n\t\t\t\tactivityContentId: subjectId,\r\n\t\t\t},\r\n\t\t\ttitleBar: {\r\n\t\t\t\ttitle: lng.user,\r\n\t\t\t\tbuttons: [\r\n                    {id: 'btnBatch', className: 'btn-create', html: `${lng.sendBatchInvite}`},\r\n                    {id: 'btnAdd', className: 'btn-create', html: `<i class=\"ico ico-create\"></i> ${lng.add}`}\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tcolumns: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.userName, width: 200,\r\n\t\t\t\t\tsrc: 'firstname',\r\n\t\t\t\t\trender: (firstname, i, row) => {\r\n\t\t\t\t\t\treturn `${firstname||''} ${row.lastname||''}`;\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.userRole, width: 150,\r\n\t\t\t\t\tsrc: 'rolename',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.userLoginName,\r\n\t\t\t\t\tsrc: 'username',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.isInvited,\r\n\t\t\t\t\tsrc: 'invite',\r\n\t\t\t\t\twidth: 160 ,\r\n\t\t\t\t\trender: (invite , i , row) => {\r\n\t\t\t\t\t\treturn `${isInvitedHash[invite]}`\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.isAccepted,\r\n\t\t\t\t\tsrc: 'accept',\r\n\t\t\t\t\twidth: 130,\r\n\t\t\t\t\trender : (accept , i , row)=>{\r\n\t\t\t\t\t\tif(accept == -1){\r\n\t\t\t\t\t\t\treturn `<button class=\"btn-mini btn-success btnAgree\" data-userid=\"${row.user_id}\"  data-accept=\"1\">${lng.agree}</button> \r\n\t\t\t\t\t\t\t\t\t<button class=\"btn-mini btn-warning btnDeny\" data-userid=\"${row.user_id}\"  data-accept=\"0\">${lng.deny}</button>`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn lng.isAcceptedHash[accept];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.rateScore,\r\n\t\t\t\t\tsrc: 'evalutegetscore',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.signInScore,\r\n\t\t\t\t\tsrc: 'signgetscore',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lng.process,\r\n\t\t\t\t\tsrc: 'user_id',\r\n\t\t\t\t\twidth: 180,\r\n\t\t\t\t\trender: id => {\r\n\t\t\t\t\t\treturn `\r\n\t\t\t\t\t\t\t<button data-id=\"${id}\" class=\"btn-mini btn-danger btnDel\">${lng.del}</button>\r\n\t\t\t\t\t\t\t<button data-id=\"${id}\" class=\"btn-mini btn-primary btnMsg\">${lng.sendInvite}</button>\r\n\t\t\t\t\t\t`;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tpagination: true,\r\n\t\t});\r\n\r\n\r\n\t\tlet self = this;\r\n\t\tthis.tb.tbody.on('click', '.btnAgree,.btnDeny', function () {\r\n\t\t\tlet btn = $(this),  userId = ~~btn.data('userid'),  accept = ~~btn.data('accept');\r\n\t\t\topg.api.reply({activityContentId : subjectId , userId , accept}, data => {\r\n\t\t\t\tself.tb.update();\r\n\t\t\t});\r\n\r\n\r\n\t\t});\r\n\r\n\r\n\t\t//add\r\n\t\t$('#btnAdd').click(() => {\r\n\t\t\tthis.addUser();\r\n\t\t});\r\n\r\n        //send batch message\r\n        $('#btnBatch').click(() => {\r\n            this.msgUserBatch();\r\n        });\r\n\r\n\t\t//delete\r\n\t\tthis.tb.tbody.on('click', '.btnDel', (e) => {\r\n\t\t\tlet btn = $(e.target), id = ~~btn.data('id');\r\n\t\t\tthis.deleteUser(id);\r\n\t\t});\r\n\r\n\t\t//send message\r\n\t\tthis.tb.tbody.on('click', '.btnMsg', (e) => {\r\n\t\t\tlet btn = $(e.target), id = ~~btn.data('id');\r\n\t\t\tthis.msgUser(id);\r\n\t\t});\r\n\t}\r\n\r\n\tmsgUserBatch() {\r\n        let that = this;\r\n\r\n        let param = $('#tbMain').fieldsToJson({\r\n\r\n        });\r\n\r\n        msgForm.find('input').val(param.title);\r\n        msgForm.find('textarea').val(param.begindate + \" \" +param.time0 + \"-\" + param.time1 + \"|\" + param.location + \"|\" +  param.content + \"|\" + param.note + \"|\"+that.subjectId);\r\n        setTimeout(function () {\r\n            top.opg.confirm(msgForm , function () {\r\n                let obj = {\r\n                    \"activityContentId\": that.subjectId,\r\n                    \"message\":{\r\n                        \"msgtype\":2,\r\n                        \"msgtitle\": msgForm.find('input').val(),\r\n                        \"msgcontent\": msgForm.find('textarea').val()\r\n                    }\r\n                };\r\n\r\n                opg.api.sendBatchInvite(obj , data=>{\r\n                    opg.ok(lng.sendBatchInvite);\r\n                    that.tb.update();\r\n                    (msgForm[0] as HTMLFormElement).reset();\r\n                });\r\n            });\r\n        }, 1000);\r\n\t}\r\n\r\n\tmsgUser(userId :number){\r\n\t\tlet that = this;\r\n\r\n        let param = $('#tbMain').fieldsToJson({\r\n\r\n        });\r\n\r\n\t\tmsgForm.find('input').val(param.title);\r\n        msgForm.find('textarea').val(param.begindate + \" \" +param.time0 + \"-\" + param.time1 + \"|\" + param.location + \"|\" +  param.content + \"|\" + param.note+ \"|\"+that.subjectId);\r\n\r\n        setTimeout(function () {\r\n            top.opg.confirm(msgForm , function () {\r\n                let obj = {\r\n                    \"activityContentId\": that.subjectId,\r\n                    \"userId\": userId,\r\n                    \"message\":{\r\n                        \"msgtype\":2,\r\n                        \"userId\":userId,\r\n                        \"msgtitle\": msgForm.find('input').val(),\r\n                        \"msgcontent\": msgForm.find('textarea').val()\r\n                    }\r\n                };\r\n\r\n                opg.api.sendInvite(obj , data=>{\r\n                    opg.ok(lng.sendInvite);\r\n                    that.tb.update();\r\n                    (msgForm[0] as HTMLFormElement).reset();\r\n                })\r\n            });\r\n        }, 1000);\r\n\t}\r\n\r\n\taddUser() {\r\n\t\tlet that = this;\r\n\t\tlet src = url.setParam(page, {subjectId: this.subjectId});\r\n\t\tlet pop: Popup = top.opg.confirm(`<iframe src=\"${src}\"></iframe>`, function (i, ifr) {\r\n\t\t\tifr.save(pop , that.tb);\r\n\t\t\treturn true;\r\n\t\t}, {\r\n\t\t\ttitle: lng.addUser,\r\n\t\t\tbtnMax: true,\r\n\t\t\twidth: 800,\r\n\t\t\theight: 530,\r\n\t\t\tbuttons: {\r\n\t\t\t\tok:lng.okb,\r\n\t\t\t\tcancel:lng.cancelb\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tdeleteUser(id: number) {\r\n\t\tlet that = this;\r\n\t\tlet pop: Popup = opg.confirm(lng.deleteGuestConfirm, function () {\r\n\r\n\t\t\topg.api.delUser({activityContentId: that.subjectId, userId: id}, data => {\r\n\t\t\t\tthat.tb.update();\r\n\t\t\t\tpop.close();\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n}"]}