{"version":3,"sources":["/pages/itb/events/subView.ts"],"names":[],"mappings":"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","file":"subView.js","sourcesContent":["import {api} from 'ts/util/api';\r\nimport opg from '../../../ts/opg';\r\nimport {Languages} from '/ts/util/Languages';\r\nimport {request, url} from '../../../ts/util/utils';\r\n\r\nconst id = request['id'];\r\nconst img = request['img'];\r\n\r\napi({\r\n\tgetSubs: `activity/GetActivityContentsByActivityIdFront?id=${id}`,\r\n\tgetSubDetail: 'activity/GetActivityContentInfoById',\r\n\tsendApply: 'activity/ApplyingActivityContent',\r\n    sendApplyNoApproval:'activity/ApplyingActivityContentNoApproval'\r\n});\r\napi.getSubDetail.set('unlimited', true);\r\n\r\n\r\nconst lpg = Languages.package;\r\nconst moduleName = lpg.moduleName;\r\n\r\n\r\nopg.api.getSubs(data => {\r\n\tgetSubjectsDetail(data, (list) => {\r\n\t\tvar i=0,ll=list.length;\r\n\t\tfor (; i < ll; i++) {\r\n\t\t\tif(list[i].scope==\"2\" && list[i].invite==\"-1\")\r\n\t\t\t\tdelete list[i];\r\n        }\r\n\r\n\t\tlet tbSubjects = opg('#tbSub').table({\r\n\t\t\tdata: list,\r\n\t\t\ttitleBar: {\r\n\t\t\t\ttitle: lpg.subjectsList,\r\n\t\t\t},\r\n\t\t\tcolumns: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lpg.topic,\r\n\t\t\t\t\tsrc: 'title', width: 100,\r\n\t\t\t\t\trender: (title, i, row) => `<a class=\"aView\" href=\"javascript:void(0)\" data-id=\"${row.id}\">${title}</a>`,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lpg.content,\r\n\t\t\t\t\twidth:200,\r\n\t\t\t\t\tsrc: 'content',\r\n\t\t\t\t\talign: 'left',\r\n\t\t\t\t},\r\n                {\r\n                    text: lpg.scopetype, width: 100,\r\n                    src: 'scope',\r\n                    render: (time, i, row) => {\r\n                        return `${lpg.scope[row.scope]}`;\r\n                    },\r\n                },\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lpg.time, width: 100,\r\n\t\t\t\t\tsrc: 'time',\r\n\t\t\t\t\trender: (time, i, row) => {\r\n\t\t\t\t\t\treturn `${row.begindate.split(' ')[0]} ${time}`;\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: lpg.process, width: 200,\r\n\t\t\t\t\tsrc: 'detail',\r\n\t\t\t\t\trender: (detail, i, row) => {\r\n\t\t\t\t\t\tlet html = '';\r\n\t\t\t\t\t\tif (row.scope == 1 || row.scope == 0) {\r\n\t\t\t\t\t\t\tif (detail.applyState.applied) {\r\n\t\t\t\t\t\t\t\tif (detail.applyState.accept == -1) {\r\n\t\t\t\t\t\t\t\t\thtml += lpg.waitingConfirm;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (detail.applyState.accept == 1) {\r\n\t\t\t\t\t\t\t\t\thtml += lpg.agreed;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (detail.applyState.accept == 0) {\r\n\t\t\t\t\t\t\t\t\thtml += lpg.denied;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tlet msg=`${lpg.sendApply}`;\r\n\t\t\t\t\t\t\t\tif(row.scope==1)\r\n\t\t\t\t\t\t\t\t\tmsg=`${lpg.sendApply2}`\r\n\t\t\t\t\t\t\t\thtml += `<button class=\"btn-mini btn-info\" data-id=\"${row.id}\" data-scope=\"${row.scope}\">`+ msg + `</button>`;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (row.scope == 2) {\r\n\t\t\t\t\t\t\tif (detail.applyState.invite == 1) {\r\n\t\t\t\t\t\t\t\tif (detail.applyState.accept == -1) {\r\n\t\t\t\t\t\t\t\t\thtml += lpg.waitingConfirm;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (detail.applyState.accept == 1) {\r\n\t\t\t\t\t\t\t\t\thtml += lpg.agreed;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (detail.applyState.accept == 0) {\r\n\t\t\t\t\t\t\t\t\thtml += lpg.denied;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn html;\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t});\r\n\r\n\r\n\t\tconst pageSrc = __uri('./detail.html');\r\n\t\ttbSubjects.tbody.on('click', '.aView', function () {\r\n\t\t\tlet title = this.textContent, id = this.getAttribute('data-id');\r\n\t\t\tlet src = url.setParam(pageSrc, {id});\r\n\t\t\topg.popTop(`<iframe src=\"${src}\"></iframe>`, {\r\n\t\t\t\ttitle: lpg.viewDetail,\r\n\t\t\t\twidth: 500,\r\n\t\t\t\theight: 500,\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\ttbSubjects.tbody.on('click', '.btn-info', function (e) {\r\n            let scope=e.target.getAttribute(\"data-scope\");\r\n\r\n            if(scope==\"0\") {\r\n                api.sendApply({id: this.getAttribute('data-id')}, data => {\r\n                    location.reload(true);\r\n                });\r\n            }\r\n            else if(scope==\"1\") {\r\n                api.sendApplyNoApproval({id: this.getAttribute('data-id')}, data => {\r\n                    location.reload(true);\r\n                });\r\n            }\r\n\r\n\t\t});\r\n\t});\r\n});\r\n\r\n\r\nfunction getSubjectsDetail(list: Array, callback: Function) {\r\n\tlet i = 0, l = list.length, n = 0;\r\n\tfor (; i < l; i++) {\r\n\t\tlet an = list[i];\r\n\r\n            api.getSubDetail({id: an.id}, data => {\r\n                an['detail'] = data;\r\n                if (++n === l) {\r\n                    callback(list);\r\n                }\r\n            });\r\n\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n"]}