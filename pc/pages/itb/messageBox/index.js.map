{"version":3,"sources":["/pages/itb/messageBox/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import {api} from '/ts/util/api';\r\nimport {store} from 'ts/util/store.ts';\r\nimport {Languages} from '/ts/util/Languages';\r\nimport Table from 'ts/ui/Table.ts';\r\nimport Panel from 'ts/ui/Panel';\r\nimport PopUp from 'ts/ui/Popup';\r\nimport opg from \"../../../ts/opg\";\r\n\r\napi({\r\n    getList: 'message/GetMessageByCurrentUser', //0未读，1已读，其他为全部\r\n    setRead: 'message/UpMessageStatusByMsgId?status=1', //1 已读\r\n    reply: 'activity/AllowOrDenyActivityContentForUser', // 0是拒绝 1是同意\r\n    replySchedule: 'schedule/AllowOrDenyScheduleForUser' // 0是拒绝 1是同意\r\n});\r\n\r\nconst lpg = Languages.package;\r\nconst moduleName = lpg.moduleName;\r\n\r\nlet currentState = -1;\r\n\r\napi.replySchedule.set('onError',function(code , error, callback){\r\n    if (code === 200 && (error === 'AllowOrDenyScheduleForUser_Error01' || error === 'AllowOrDenyScheduleForUser_Error02'|| error === 'AllowOrDenyScheduleForUser_Error03'))\r\n    {\r\n        let errorMsg = lpg['tips'];\r\n        top.opg.confirm(`${errorMsg}`,function() {\r\n\r\n        });\r\n    }\r\n});\r\n\r\n\r\nopg.wrapPanel('#tbSearch', {\r\n    title: `${moduleName}`,\r\n    btnSearchId: null,\r\n});\r\n\r\nlet selStatus = $('#status').on('change', function () {\r\n    currentState = ~~selStatus.val();\r\n    tb.update({status: currentState})\r\n});\r\n\r\nlet curLng = store.get('lngPkg');\r\nlet customParse = function (msg) {\r\n    let msgObj = JSON.parse(msg);\r\n    if (curLng == 'cn') {\r\n        return Languages.package['scheduleMsgTpl']\r\n            .replace('{company}', msgObj.fromCompanyCn ? `${msgObj.fromCompanyCn}公司` : '')\r\n            .replace('{title}', msgObj.fromTitleCn ? `${msgObj.fromTitleCn}` : '')\r\n            .replace('{name}', msgObj.fromNameCn)\r\n            .replace('{time}', msgObj.date);\r\n    } else {\r\n        return Languages.package['scheduleMsgTpl']\r\n            .replace('{company}', msgObj.fromCompany ? `${msgObj.fromCompany} Company ` : '')\r\n            .replace('{title}', msgObj.fromTitle ? `${msgObj.fromTitle}` : '')\r\n            .replace('{name}', msgObj.fromName)\r\n            .replace('{time}', msgObj.date);\r\n    }\r\n};\r\n\r\nlet customParse2 = function (msg) {\r\n    let msgObj = JSON.parse(msg);\r\n    return msgObj.message?`${msgObj.message}`:'';\r\n};\r\n\r\nlet htmlFormat=function(msg) {\r\n    let msgarray=msg.split(\"|\");\r\n    return msgarray\r\n};\r\n\r\nlet tb: Table = opg('#tb').table({\r\n    api: opg.api.getList,\r\n    param: {status: -1},\r\n    titleBar: {\r\n        title: `${moduleName}${lpg.list}`,\r\n    },\r\n    columns: [\r\n        {\r\n            text: lpg.msgtitle,\r\n            width: 300,\r\n            src: 'msgtitle',\r\n        },\r\n        {\r\n            text: `${lpg.msgcontent}`,\r\n            //src: 'msgcontent',\r\n            render: (id, i, row) => {\r\n                let html=``;\r\n                if (row.msgtype == 3) {\r\n                    html+=`<div>` + customParse(row.msgcontent) + `</div>`;\r\n                }\r\n                else if(row.msgtype == 1 || row.msgtype == 0) {\r\n                    html+=`<div>` + customParse2(row.msgcontent) + `</div>`;\r\n                }\r\n                else if(row.msgtype == 2) {\r\n                    var s='';\r\n                    for (var hf=0,itemf; hf< htmlFormat(row.msgcontent).length,itemf=htmlFormat(row.msgcontent)[hf];hf++) {\r\n                        if (hf < htmlFormat(row.msgcontent).length - 1) {\r\n                            s = s + itemf + '<br/>';\r\n                        }\r\n                    }\r\n                    html+=`<div>` + s + `</div>`;\r\n                }\r\n                else {\r\n                    var content=row.msgcontent.split(\"|\");\r\n                    html+=`<div>` + content[0] + \" Meeting with \" + content[2] + \" at booth:\" + content[1] + \".（您与\" + content[2] + \"有一场会议，展位：\" + content[1] + \"。）\"+ `</div>`;\r\n                }\r\n                return html;\r\n            }\r\n        },\r\n        {\r\n            text: `${lpg.from}`,\r\n            width: 150,\r\n            src: 'firstname',\r\n            render: (fn, i, row) => `${fn || ''} ${row.lastname || ''}`\r\n        },\r\n        {\r\n            text: `${lpg.process}`,\r\n            src: 'id',\r\n            width: 250,\r\n            render: function (id, i, item) {\r\n                //console.log(arr);\r\n                let html = (item.status === 0 ? `<button class=\"btn-mini btn-info btnSet\" data-id=\"${id}\">${lpg.setRead}</button> ` : '');\r\n                if (item.msgtype == 2) {\r\n                    if (item.accept == -1) {\r\n                        html += `\r\n\t\t\t\t\t\t\t\t<button class=\"btn-mini btn-success btnAgree\" data-acid=\"${item.activityContentId}\" data-accept=\"1\">${lpg.agree}</button>\r\n\t\t\t\t\t\t\t\t<button class=\"btn-mini btn-danger btnDeny\" data-acid=\"${item.activityContentId}\" data-accept=\"0\">${lpg.deny}</button>\r\n\t\t\t\t\t\t\t`\r\n                    }\r\n                    else {\r\n                        html += (item.accept == 1 ? lpg.agreed : lpg.denied)\r\n                    }\r\n                }\r\n                else if(item.msgtype==3) {\r\n                    if (item.scheduleaccept == -1) {\r\n                        html += `\r\n\t\t\t\t\t\t\t\t<button class=\"btn-mini btn-success btnAgreeSchedule\" data-acid=\"${item.id}\" data-accept=\"1\">${lpg.agree}</button>\r\n\t\t\t\t\t\t\t\t<button class=\"btn-mini btn-danger btnDenySchedule\" data-acid=\"${item.id}\" data-accept=\"0\">${lpg.deny}</button>\r\n\t\t\t\t\t\t\t`\r\n                    }\r\n                    else {\r\n                        html += (item.scheduleaccept == 1 ? lpg.agreed : lpg.denied)\r\n                    }\r\n                }\r\n\r\n                return html;\r\n            },\r\n        },\r\n    ],\r\n    pagination: false,\r\n});\r\n\r\ntb.tbody.on('click', '.btnSet', function () {\r\n    api.setRead({msgId: this.getAttribute('data-id')}, data => tb.update());\r\n});\r\n\r\ntb.tbody.on('click', '.btnAgree,.btnDeny', function () {\r\n    let btn = $(this), activityContentId = ~~btn.data('acid'), accept = ~~btn.data('accept');\r\n    api.reply({activityContentId, accept}, data => tb.update());\r\n});\r\n\r\n\r\n\r\ntb.tbody.on('click', '.btnAgreeSchedule,.btnDenySchedule', function () {\r\n    let btn = $(this), id = ~~btn.data('acid'), accept = ~~btn.data('accept');\r\n    api.replySchedule({id, accept}, data => tb.update());\r\n});\r\n\r\n\r\n"]}