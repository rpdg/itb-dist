{"version":3,"sources":["/pages/itb/wishlist/view.ts"],"names":[],"mappings":"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","file":"view.js","sourcesContent":["/// <reference path=\"../../../@types/jquery.d.ts\" />\r\n/// <reference path=\"../../../@types/jquery.plugins.d.ts\" />\r\n\r\nimport opg from '../../../ts/opg';\r\nimport Table from '../../../ts/ui/Table';\r\nimport { Languages } from '../../../ts/util/Languages';\r\nimport { store } from '../../../ts/util/store';\r\nimport PopUp from '../../../ts/ui/Popup';\r\nimport { api } from '../../../ts/util/api';\r\n\r\nconst currentRole = store.get('RoleName');\r\nconst currentStage = store.get('Stage');\r\nconst lngPkg = Languages.package;\r\n\r\nif (currentRole === 'buyer') {\r\n\topg.api({\r\n\t\tmyList: 'buyer/GetBuyerChooseExhibitionWishlist',\r\n\t\tdel: 'buyer/DelBuyerWhilistByExhibitionBarCode',\r\n\t\t'updateListSort!post': 'buyer/UpdateBuyerChooseExhibitions'\r\n\t});\r\n} else if (currentRole === 'exhibition') {\r\n\topg.api({\r\n\t\tmyList: 'exhibition/ExhibitionChooseWishListResultForView',\r\n\t\tdel: 'exhibition/DelExhibtionWhilistByBuyerBarCode',\r\n\t\t'updateListSort!post': 'exhibition/UpdateExhibitionChooseBuyers'\r\n\t});\r\n}\r\n\r\nif (currentStage === 'wishlist') {\r\n\t$('#btnselected').show();\r\n\t$('#btnselected').html(lngPkg.btnselected);\r\n} else {\r\n\t$('#btnselected').hide();\r\n\t$('#btnselected').html(lngPkg.btnselected);\r\n}\r\n\r\nlet barcodeArr: string[];\r\n\r\nlet tb: Table = opg('#tb').table({\r\n\tapi: opg.api.myList,\r\n\ttitleBar: {\r\n\t\ttitle: lngPkg.list\r\n\t},\r\n\tcolumns: [\r\n\t\t{\r\n\t\t\ttext: ' ',\r\n\t\t\twidth: 64,\r\n\t\t\talign: 'center',\r\n\t\t\tsrc: 'company',\r\n\t\t\trender: function(id, i, row) {\r\n\t\t\t\treturn i + 1;\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: lngPkg.th1,\r\n\t\t\tsrc: 'company',\r\n\t\t\trender: function(id, index, row) {\r\n\t\t\t\tlet html = `${row.company} 【` + ` ${row.Name}】<b class=\"ico-handle\">≡</b>`;\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: lngPkg.th2,\r\n\t\t\twidth: 180,\r\n\t\t\tsrc: 'applieddatetime'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: lngPkg.th3,\r\n\t\t\twidth: 100,\r\n\t\t\tsrc: 'barcode',\r\n\t\t\trender: function(id, index, row) {\r\n\t\t\t\tlet html = `<button data-id=\"${row.barcode}\"  class=\"btn-mini btn-danger\" >${lngPkg.th4}</button> `;\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tpagination: false,\r\n\tonAjaxEnd: function(data) {\r\n\t\tconsole.log(data);\r\n\t\tlet arr = [];\r\n\t\tfor (let i = 0, l = data.length; i < l; i++) {\r\n\t\t\tarr.push(data[i].barcode);\r\n\t\t}\r\n\t\tbarcodeArr = arr;\r\n\t}\r\n});\r\n\r\ntb.tbody.on('click', '.btn-danger', function() {\r\n\tlet barcode =  $(this).data('id');\r\n\r\n\ttop.opg.confirm(\r\n\t\tlngPkg.Content,\r\n\t\tfunction() {\r\n\t\t\tif(currentStage === 'wishlist'){\r\n\t\t\t\tlet param :any = {};\r\n\t\t\t\tif (currentRole == 'buyer'){\r\n\t\t\t\t\tparam.exhbitionBarCode = barcode ;\r\n\t\t\t\t}\r\n\t\t\t\telse if(currentRole == 'exhibition'){\r\n\t\t\t\t\tparam.buyerBarCode = barcode ;\r\n\t\t\t\t}\r\n\r\n\t\t\t\topg.api.del(param, data => {\r\n\t\t\t\t\ttb.update();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: lngPkg.Tips ,\r\n\t\t}\r\n\t);\r\n});\r\n\r\n$('#btnselected').click(function() {\r\n\tlocation.href = 'index.html';\r\n});\r\n\r\nlet slippyList = $('#tb').find('tbody')[0];\r\n\r\nslippyList.addEventListener(\r\n\t'slip:beforereorder',\r\n\tfunction(e) {\r\n\t\tif ((e.target as HTMLElement).tagName === 'BUTTON') {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\tfalse\r\n);\r\n\r\nslippyList.addEventListener(\r\n\t'slip:beforewait',\r\n\tfunction(e) {\r\n\t\te.preventDefault();\r\n\t},\r\n\tfalse\r\n);\r\n\r\nslippyList.addEventListener(\r\n\t'slip:reorder',\r\n\tfunction(e: any) {\r\n\t\t(e.target as HTMLElement).parentNode.insertBefore(e.target as HTMLElement, (e.detail as any).insertBefore);\r\n\t\tupdateSort();\r\n\t\treturn false;\r\n\t},\r\n\tfalse\r\n);\r\n\r\nnew Slip(slippyList);\r\n\r\nfunction updateSort() {\r\n\tlet barCodes = [];\r\n\r\n\t$('tr', slippyList).each((i, tr: HTMLTableRowElement) => {\r\n\t\tlet btn = $(tr).find('button')[0];\r\n\t\tbarCodes.push(btn.getAttribute('data-id'));\r\n\t});\r\n\r\n\tif (JSON.stringify(barCodes) === JSON.stringify(barcodeArr)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (currentRole == 'buyer') {\r\n\t\tapi.updateListSort({ exhibitionBarCodes: barCodes }, () => {\r\n\t\t\tbarcodeArr = barCodes;\r\n\t\t\ttb.update();\r\n\t\t});\r\n\t} else {\r\n\t\tapi.updateListSort({ buyerBarCodes: barCodes }, () => {\r\n\t\t\tbarcodeArr = barCodes;\r\n\t\t\ttb.update();\r\n\t\t});\r\n\t}\r\n}\r\n"]}