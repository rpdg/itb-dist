{"version":3,"sources":["/pages/itb/schedule/schedule.ts"],"names":[],"mappings":"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","file":"schedule.js","sourcesContent":["import {api} from '/ts/util/api';\r\nimport {Languages} from '/ts/util/Languages';\r\nimport {convert, dateTime, format, string} from '/ts/util/utils';\r\nimport {store} from '/ts/util/store';\r\n\r\napi({\r\n\tgetTime: 'system/GetExhibitionPublicData',  //全部时间列表\r\n\tmySchedule: 'user/GetCurUserActivitySchedule', //获取当前用户 活动或会议 SCHDULE (informationtype == 0? 'Meeting' | informationtype == 1? 'Activity)\r\n\tgetBusyDateByBarCode: 'userBusyDate/GetBusyDateByBarCode',  //不可占用的时间\r\n\tbuyerDating: 'schedule/GetBuyerSchedules', // 获取当前买家 约会 schedule\r\n\texhibitionDating: 'schedule/GetExhibitionSchedules',  //获取当前展商 约会 schedule\r\n});\r\n\r\n\r\nconst roleName = (store.get('RoleName') as string).toLowerCase();\r\nconst role = roleName === 'exhibition' ? 'exhibition' : 'buyer';\r\nconst stage = store.get('Stage');\r\n\r\n\r\nfunction makeSerial(startTime: string, endTime: string) {\r\n\tlet st = startTime.split(':'), et = endTime.split(':');\r\n\r\n\tlet arr = [];\r\n\r\n\tfor (let i = parseInt(st[0], 10) + (st[1] == '30' ? 0.5 : 0), l = parseInt(et[0], 10) + (et[1] == '30' ? 0.5 : 0); i < l; i += 0.5) {\r\n\t\tlet tick = '' + string.padLeft(~~i, 2) + (i % 1 === 0 ? ':00' : ':30');\r\n\t\tlet tick2 = '' + string.padLeft(~~(i + 0.5), 2) + ((i + 0.5) % 1 === 0 ? ':00' : ':30');\r\n\r\n\t\tarr.push(tick + '-' + tick2);\r\n\t}\r\n\r\n\treturn arr;\r\n}\r\n\r\n\r\ntype OnePartTime = {\r\n\tacts: Array;\r\n\tusable: boolean;\r\n\thasActivity: boolean;\r\n\thasAppointment: boolean;\r\n\tisBusy: boolean;\r\n\tshowAddTo: boolean;\r\n};\r\ntype OneDay = {\r\n\tdate: Date;\r\n\ttime: HashMap<OnePartTime>\r\n};\r\ntype FullDay = {\r\n\tlng: any;\r\n\troleName: string;\r\n\tstage: string;\r\n\tyear: number;\r\n\tdayArr: OneDay[];\r\n\tdays: HashMap<OneDay>;\r\n};\r\n\r\n\r\nlet fullObj: FullDay = {\r\n\tlng: Languages.package,\r\n\troleName,\r\n\tstage,\r\n\tyear: 2018,\r\n\tdays: {},\r\n\tdayArr: [],\r\n};\r\n\r\nlet scheduleData: any;\r\nlet datingData: any;\r\nlet busyDateData: any;\r\n\r\n\r\n\r\nexport default class Schedule {\r\n\tstatic fetch(callback: Function) {\r\n\r\n\t\t$.when(\r\n\t\t\t//全部时间列表\r\n\t\t\tapi.getTime(timeData => {\r\n\r\n\t\t\t\tlet startDate = new Date(Date.parse(timeData.beginDate));\r\n\t\t\t\tlet endDate = new Date(Date.parse(timeData.endDate));\r\n\t\t\t\tlet days = dateTime.daySpan(startDate, endDate) + 1;\r\n\r\n\t\t\t\tfullObj.year = startDate.getFullYear();\r\n\r\n\t\t\t\tfor (let a = 0, b = days; a < b; a++) {\r\n\t\t\t\t\tlet theDay: Date = dateTime.addDays(startDate, a);\r\n\t\t\t\t\tlet dayObj: OneDay = {\r\n\t\t\t\t\t\tdate: theDay,\r\n\t\t\t\t\t\ttime: {},\r\n\t\t\t\t\t};\r\n\t\t\t\t\tfullObj.days[format.date(theDay)] = dayObj;\r\n\t\t\t\t\tfullObj.dayArr.push(dayObj);\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tlet lunchTime = timeData.publicDate[0].dateTimes[0].split('-');\r\n\t\t\t\tlet unusableTimeArr = makeSerial(lunchTime[0], lunchTime[1]);\r\n\r\n\r\n\t\t\t\tlet startTime = timeData.beginTime, endTime = timeData.endTime;\r\n\r\n\t\t\t\t//console.warn(unusableTimeArr);\r\n\r\n\t\t\t\tlet timeSerial = makeSerial(startTime, endTime);\r\n\t\t\t\tfor (let d in fullObj.days) {\r\n\t\t\t\t\tlet alreadyAddedRestTime = false;\r\n\t\t\t\t\tlet dayObj = fullObj.days[d];\r\n\t\t\t\t\tlet canUse = true, willAdd = true;\r\n\t\t\t\t\ttimeSerial.forEach(spanStr => {\r\n\t\t\t\t\t\tif (unusableTimeArr.indexOf(spanStr) > -1) {\r\n\t\t\t\t\t\t\tif (alreadyAddedRestTime) {\r\n\t\t\t\t\t\t\t\twillAdd = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcanUse = false;\r\n\t\t\t\t\t\t\t\talreadyAddedRestTime = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tcanUse = true;\r\n\t\t\t\t\t\t\twillAdd = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (willAdd) {\r\n\t\t\t\t\t\t\tdayObj.time[spanStr] = {\r\n\t\t\t\t\t\t\t\tusable: canUse,\r\n\t\t\t\t\t\t\t\tacts: [],\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tapi.mySchedule(data => {\r\n\t\t\t\tscheduleData = data;\r\n\t\t\t}),\r\n\t\t\tapi[`${role}Dating`](data => {\r\n\t\t\t\tdatingData = data;\r\n\t\t\t\tconsole.log(datingData);\r\n\t\t\t}),\r\n\t\t\tapi.getBusyDateByBarCode(data => {\r\n\t\t\t\tbusyDateData = data;\r\n\t\t\t}),\r\n\t\t)\r\n\t\t\t.then(function () {\r\n\r\n\r\n\t\t\t\tSchedule.mergeBusyDateData(fullObj, busyDateData);\r\n\t\t\t\tSchedule.mergeAppointData(fullObj, datingData);\r\n\t\t\t\tSchedule.mergeScheduleData(fullObj, scheduleData);\r\n\r\n\r\n\t\t\t\tif(stage==='open diary') {\r\n                    let timeSlot\r\n\t\t\t\t\tif(!(roleName === 'visitor' && stage==='open diary')) {\r\n\t\t\t\t\t\tfullObj.dayArr.forEach((day: OneDay) => {\r\n\t\t\t\t\t\t\tfor (let timeCode: string in day.time) {\r\n\t\t\t\t\t\t\t\ttimeSlot = day.time[timeCode];\r\n\t\t\t\t\t\t\t\tif (!timeSlot.hasAppointment  && !timeSlot.isBusy) {\r\n\t\t\t\t\t\t\t\t\ttimeSlot.showAddTo = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ttimeSlot.showAddTo = false;\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tconsole.log(fullObj);\r\n\r\n\t\t\t\tcallback(fullObj);\r\n\r\n\t\t\t});\r\n\t}\r\n\r\n\t//被占用时间段\r\n\tprivate static mergeBusyDateData(fullObj, datingData) {\r\n\r\n\t\tif (datingData && datingData.length) {\r\n\r\n\t\t\tdatingData.forEach((it, index) => {\r\n\r\n\t\t\t\tlet //beginDate = convert.stringToDate(it.busybegindate),\r\n\t\t\t\t\tbeginDateDay: string = it.busybegindate.substr(0, 10),\r\n\t\t\t\t\tbeginTime: string = it.busybegindate.substr(11, 5),\r\n\t\t\t\t\tendTime: string = it.busyenddate.substr(11, 5),\r\n\t\t\t\t\ttarDay: OneDay = fullObj.days[beginDateDay];\r\n\r\n\t\t\t\t//console.log(beginDateDay,beginTime,endTime);\r\n\r\n\t\t\t\tif (tarDay) {\r\n\t\t\t\t\tlet timeArr = makeSerial(beginTime, endTime);\r\n\t\t\t\t\ttimeArr.forEach((timecode: string) => {\r\n\t\t\t\t\t\tlet timePart: OnePartTime = tarDay.time[timecode];\r\n\t\t\t\t\t\tif (timePart && timePart.usable) {\r\n\t\t\t\t\t\t\ttimePart.isBusy = true;\r\n\t\t\t\t\t\t\tit.cantAdd = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tit.cantAdd = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t\tif (it.cantAdd)\r\n\t\t\t\t\t\tconsole.warn('BusyDate', it);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdelete it.cantAdd;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t//面谈\r\n\tprivate static mergeAppointData(fullObj, datingData) {\r\n\r\n\t\tif (datingData && datingData.length) {\r\n\r\n\r\n\t\t\tdatingData.forEach((it, index) => {\r\n\t\t\t\tlet dateStr = it.begindate.split(' ')[0],\r\n\t\t\t\t\ttarDay: OneDay = fullObj.days[dateStr];\r\n\r\n\t\t\t\tif (tarDay) {\r\n\t\t\t\t\tlet fromTimeStr;\r\n\t\t\t\t\tif (it.begindate.substr(14, 2) == '15') {\r\n\t\t\t\t\t\tfromTimeStr = it.begindate.substr(0, 14) + '00:00';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (it.begindate.substr(14, 2) == '45') {\r\n\t\t\t\t\t\tfromTimeStr = it.begindate.substr(0, 14) + '30:00';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tfromTimeStr = it.begindate;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet fromTime = convert.stringToDate(fromTimeStr);\r\n\t\t\t\t\tlet toTime = convert.stringToDate(it.enddate);\r\n\t\t\t\t\tlet arrTimes = [fromTime];\r\n\r\n\t\t\t\t\twhile (true) {\r\n\t\t\t\t\t\tfromTime = dateTime.addSeconds(fromTime, 30 * 60);\r\n\t\t\t\t\t\tarrTimes.push(fromTime);\r\n\t\t\t\t\t\tif (fromTime.valueOf() >= toTime.valueOf()) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//console.log('arrTimes', arrTimes);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tarrTimes.forEach((date, i) => {\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tif (i > 0) {\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tlet time = format.date(arrTimes[i - 1], 'HH:mm') + '-' + format.date(date, 'HH:mm');\r\n\t\t\t\t\t\t\t//console.log('time', i, time);\r\n\r\n\t\t\t\t\t\t\tlet timePart: OnePartTime = tarDay.time[time];\r\n\t\t\t\t\t\t\tif (timePart && timePart.usable) {\r\n\r\n\t\t\t\t\t\t\t\tit.isAppoint = true;\r\n\t\t\t\t\t\t\t\tit.informationtype = 3;\r\n\t\t\t\t\t\t\t\tit.activity_id = it.id;\r\n\t\t\t\t\t\t\t\tit.accept = 1;\r\n\t\t\t\t\t\t\t\ttimePart.acts.push(it);\r\n\r\n\t\t\t\t\t\t\t\ttimePart.hasAppointment = true;\r\n\t\t\t\t\t\t\t\tit.cantAdd = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tit.cantAdd = true;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (it.cantAdd)\r\n\t\t\t\t\t\t\t\tconsole.warn('AppointDate', it);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tdelete it.cantAdd;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t});\r\n\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// 活动或会议 SCHDULE\r\n\tprivate static mergeScheduleData(fullObj, scheduleData) {\r\n\t\tif (scheduleData && scheduleData.length) {\r\n\r\n\r\n\t\t\tscheduleData.forEach((it, index) => {\r\n\t\t\t\tlet dateStr: string = it.begindate.split(' ')[0], tarDay: OneDay = fullObj.days[dateStr];\r\n\r\n\t\t\t\tif (tarDay) {\r\n\t\t\t\t\tlet occupyTimes: Array = it.occupytime.split(',');//10:30-11:00,15:30-16:00\r\n\t\t\t\t\toccupyTimes.forEach(timeRange => {\r\n\t\t\t\t\t\ttimeRange = timeRange.replace(/ /g, '');\r\n\t\t\t\t\t\tlet timePart: OnePartTime = tarDay.time[timeRange];\r\n\r\n\t\t\t\t\t\tif (timePart && timePart.usable) {\r\n\t\t\t\t\t\t\ttimePart.hasActivity = true;\r\n\t\t\t\t\t\t\ttimePart.acts.push(it);\r\n\t\t\t\t\t\t\t/*if (stage == 'open diary' || stage == 'pre-exhibiton' || stage == 'exhibition') {\r\n\t\t\t\t\t\t\t\ttarDay.time[timeRange].acts.push({\r\n\t\t\t\t\t\t\t\t\tinformationtype: 4\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\t\tit.cantAdd = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tit.cantAdd = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (it.cantAdd)\r\n\t\t\t\t\t\tconsole.warn('ScheduleDate', it);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdelete it.cantAdd;\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n}"]}