{"version":3,"sources":["/pages/login/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import {Store, Languages,request} from '/js/util';\r\nimport {api} from '/js/api'\r\n\r\nStore.remove('Authorization');\r\n\r\n\r\napi({\r\n    'login!post': 'user/login',\r\n    'saveAppClientinfo!post':'AppRemote/SaveAppClientinfo',\r\n    'saveWeChatClientinfo!post':'AppRemote/SaveWeChatClientinfo',\r\n    'forgetPwd': 'user/ForgetPwd',\r\n    'ToRegistrationFindPwd!post':'user/ToRegistrationFindPwd'\r\n});\r\n\r\n\r\ntype userParam = {\r\n    username: string;\r\n    password: string;\r\n    remPassword ?: any;\r\n}\r\nconst rememberedUserNameKey = 'login-userParam';\r\nconst dontneedtoinputagain = 'dontneedtoinputagain';\r\nconst time = request['time'];\r\n\r\nlet sessionStore = window['sessionStorage'];\r\nsessionStore.removeItem('iswishlistback');\r\n\r\n\r\n\r\n\r\nlet dont = Store.get(dontneedtoinputagain);\r\nif (dont) {\r\n    setTimeout(function () {\r\n        $('#form1').jsonToFields(dont);\r\n    }, 200);\r\n    Store.remove(dontneedtoinputagain);\r\n}\r\n\r\n\r\nlet rememberedUser: userParam = Store.get(rememberedUserNameKey) as userParam;\r\n\r\nif (rememberedUser) {\r\n    $('#username').val(rememberedUser.username);\r\n    $('#password').val(rememberedUser.password);\r\n    $('#remPassword').prop('checked', true);\r\n}\r\n/*chkRemember.on('change' , function () {\r\n\tif(this.checked){\r\n\t\tStore.get(rememberedUserNameKey);\r\n\t}\r\n});*/\r\n\r\nconst infoid=request['infoid'];\r\nconst token=request['token'];\r\nconst clientid=request['clientid'];\r\nconst appid=request['appid'];\r\nconst appkey=request['appkey'];\r\nconst OpenID=request['OpenID'];\r\n\r\n\r\n\r\nconst lng = Languages.package;\r\nlet clng = 'en';\r\n\r\nif (localStorage.getItem('lngPkg') != null || localStorage.getItem('lngPkg') != undefined) {\r\n    const currentlng = localStorage.getItem('lngPkg');\r\n    clng = currentlng.replace(/[\"\"\"]/g, '');\r\n}\r\n\r\n\r\ndocument.getElementById('btnLogin').addEventListener('tap', function () {\r\n    let param: userParam = $('#form1').fieldsToJson();\r\n\r\n    if (!param.username) {\r\n        return mui.alert(`${Languages.package['require']}${Languages.package['userName']}`, Languages.package['tip'], Languages.package['ok']);\r\n    }\r\n    if (!param.password) {\r\n        return mui.alert(`${Languages.package['require']}${Languages.package['password']}`, Languages.package['tip'], Languages.package['ok']);\r\n    }\r\n\r\n    if (param.remPassword) {\r\n        delete param.remPassword;\r\n        Store.set(rememberedUserNameKey, param);\r\n    }\r\n    else {\r\n        Store.remove(rememberedUserNameKey);\r\n    }\r\n\r\n\r\n    Login(param);\r\n});\r\n\r\n\r\ndocument.getElementById('guestLogin').addEventListener('tap', function () {\r\n    let param: userParam = {\"username\": \"guest\", \"password\": \"123456\"};\r\n    Login(param);\r\n});\r\n\r\ndocument.getElementById('forgetPwd').addEventListener('tap', function () {\r\n    let param: userParam = $('#form1').fieldsToJson();\r\n\r\n    if (!param.username) {\r\n        return mui.alert(`${Languages.package['require']}${Languages.package['userName']}`, Languages.package['tip'], Languages.package['ok']);\r\n    }\r\n    api.forgetPwd({email: param.username}, (data) => {\r\n        mui.alert(`${Languages.package.forgetPwdTipOk}`, Languages.package['tip'], Languages.package['ok']);\r\n        console.log(data);\r\n    });\r\n});\r\n\r\n\r\nfunction Login(param: userParam) {\r\n    //console.log(param);\r\n    let param2={};\r\n    let param3={};\r\n\r\n    if(appid!=\"\" && appid!=undefined && appid!=null) {\r\n        Store.set('userDevice','app');\r\n        param2.infoid=infoid;\r\n        param2.token=token;\r\n        param2.clientid=clientid;\r\n        param2.appid=appid;\r\n        param2.appkey=appkey;\r\n        param2.username=param.username;\r\n\r\n        api.login(param, (token) => {\r\n\r\n            Store.set('Authorization', token);\r\n            Store.set('userName', param.username);\r\n            Store.set('locationsearch',location.search);\r\n\r\n            api.saveAppClientinfo(param2,()=>{\r\n                setTimeout(function(){\r\n                    location.href = '../dashboard/index.html';\r\n                },1000);\r\n            });\r\n        });\r\n    }\r\n    else if(OpenID!=\"\" && OpenID!=undefined && OpenID!=null) {\r\n        Store.set('userDevice','wechat');\r\n        param3.OpenID=OpenID;\r\n        param3.username=param.username;\r\n        api.login(param, (token) => {\r\n\r\n            Store.set('Authorization', token);\r\n            Store.set('userName', param.username);\r\n            Store.set('locationsearch',location.search);\r\n\r\n            api.saveWeChatClientinfo(param3,()=>{\r\n                setTimeout(function(){\r\n                    location.href = '../dashboard/index.html';\r\n                },1000);\r\n            });\r\n        });\r\n    }\r\n    else {\r\n        Store.set('userDevice','browser');\r\n\r\n        api.login(param, (token) => {\r\n\r\n            Store.set('Authorization', token);\r\n            Store.set('userName', param.username);\r\n            Store.set('locationsearch',location.search);\r\n\r\n            location.href = '../dashboard/index.html';\r\n        });\r\n    }\r\n}\r\n\r\nlet lgnSwitcher = document.getElementById('swLgn');\r\nlgnSwitcher.addEventListener('toggle', function (event: CustomEvent) {\r\n    // 不能用Store，避开Store的自动序列化\r\n    localStorage.setItem(Languages.configKeyName, Languages.names[event.detail.isActive ? 'cn' : 'en']);\r\n\r\n    setTimeout(function () {\r\n        let param = $('#form1').fieldsToJson({\r\n            username: {},\r\n            password: {},\r\n        });\r\n\r\n        Store.set(dontneedtoinputagain, param);\r\n    }, 300);\r\n\r\n\r\n    if(time==\"\" || time==undefined || time==null) {\r\n        setTimeout(() => {\r\n            if(location.search!=\"\")\r\n                location.href = './index.html'+ location.search + '&time='+((new Date()).getTime());\r\n            else\r\n                location.href = './index.html'+ location.search + '?time='+((new Date()).getTime());\r\n        }, 300);\r\n    }\r\n    else\r\n    {\r\n        setTimeout(() => {\r\n            location.href = './index.html'+ location.search;\r\n        }, 300);\r\n    }\r\n});\r\n\r\n\r\nif(clng!=\"cn\" && Store.get('wechatlanguagechange')!=\"1\" && (OpenID!=\"\" && OpenID!=undefined && OpenID!=null)) {\r\n    Store.set('wechatlanguagechange','1');\r\n    mui(\"#swLgn\").switch().toggle();\r\n}\r\n\r\n"]}