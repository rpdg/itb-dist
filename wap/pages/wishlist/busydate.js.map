{"version":3,"sources":["/pages/wishlist/busydate.ts"],"names":[],"mappings":"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","file":"busydate.js","sourcesContent":["import {api} from '/js/api';\r\nimport {convert, dateTime, format, Languages, Store, string, url} from '/js/util';\r\n\r\napi({\r\n    getTime: 'system/GetExhibitionPublicData',\r\n    getBusyDateByBarCode: 'userBusyDate/GetBusyDateByBarCode',\r\n    delBusyDate: 'userBusyDate/DelBusyDate',\r\n    'addBusyDate!post': 'userBusyDate/AddBusyDate'\r\n});\r\n\r\ntemplate.defaults.imports.dateFormat = format.date;\r\ntemplate.defaults.imports.parseInt = parseInt;\r\ntemplate.defaults.imports.log = console.log;\r\nconst lng = Store.get('lngPkg') === 'en' ? 'en' : 'cn';\r\nconst lngpackage = Languages.package;\r\ntemplate.defaults.imports.lng = lng;\r\ntemplate.defaults.imports.lngpackage = lngpackage;\r\nconst role = Store.get('RoleName') === 'exhibition' ? 'exhibition' : 'buyer';\r\n\r\nconst nowdate = new Date;\r\n\r\n\r\nfunction makeSerial(startTime: string, endTime: string) {\r\n    let st = startTime.split(':'), et = endTime.split(':');\r\n\r\n    let arr = [];\r\n\r\n    for (let i = parseInt(st[0], 10) + (st[1] == '30' ? 0.5 : 0), l = parseInt(et[0], 10) + (et[1] == '30' ? 0.5 : 0); i < l; i += 0.5) {\r\n        let tick = '' + string.padLeft(~~i, 2) + (i % 1 === 0 ? ':00' : ':30');\r\n        let tick2 = '' + string.padLeft(~~(i + 0.5), 2) + ((i + 0.5) % 1 === 0 ? ':00' : ':30');\r\n\r\n        arr.push(tick + '-' + tick2);\r\n    }\r\n\r\n    return arr;\r\n}\r\n\r\nlet fullObj: any = {\r\n    lng: Languages.package,\r\n    year: nowdate.getFullYear(),\r\n    days: {},\r\n    dayArr: [],\r\n};\r\n\r\nlet busyDateData: any;\r\n$.when(\r\n    api.getTime(timeData => {\r\n\r\n        let startDate = new Date(Date.parse(timeData.beginDate));\r\n        let endDate = new Date(Date.parse(timeData.endDate));\r\n        let days = dateTime.daySpan(startDate, endDate) + 1;\r\n\r\n        fullObj.year = startDate.getFullYear();\r\n\r\n        for (let a = 0, b = days; a < b; a++) {\r\n            let theDay = dateTime.addDays(startDate, a);\r\n            let dayObj = {\r\n                date: theDay,\r\n                time: {\r\n                    '09:30-12:00': {},\r\n                    '13:00-15:00': {},\r\n                    '15:00-17:30': {}\r\n                },\r\n            };\r\n            fullObj.days[format.date(theDay)] = dayObj;\r\n            fullObj.dayArr.push(dayObj);\r\n        }\r\n\r\n    }),\r\n    api.getBusyDateByBarCode(data => {\r\n        busyDateData = data;\r\n    })\r\n).then(function () {\r\n    if (busyDateData && busyDateData.length) {\r\n        busyDateData.forEach((it, index) => {\r\n            let beginDate = convert.stringToDate(it.busybegindate),\r\n                beginDateDay = format.date(beginDate),\r\n                beginDateTime = format.date(beginDate, 'HH:mm'),\r\n                tarDay = fullObj.days[beginDateDay];\r\n            if (tarDay) {\r\n                let endDate = convert.stringToDate(it.busyenddate),\r\n                    endDateTime = format.date(endDate, 'HH:mm');\r\n                let key = `${beginDateTime}-${endDateTime}`;\r\n                if (tarDay.time[key]) {\r\n                    tarDay.time[key].isBusy = true;\r\n                    tarDay.time[key].busyId = it.id;\r\n                } else {\r\n                    tarDay.time[key].isBusy = false;\r\n                    tarDay.time[key].busyId = '';\r\n                }\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n    document.getElementById('divBusyDateList').innerHTML = template('tpl', fullObj);\r\n\r\n    let switchDates = document.getElementsByClassName('switchDate');\r\n    for (let i = 0; i < switchDates.length; i++) {\r\n        let switchDate = switchDates[i];\r\n        mui(switchDate).switch();\r\n        switchDate.addEventListener(\"toggle\", function (event: CustomEvent) {\r\n            let curObj = $(event.target),\r\n                busyId = curObj.attr('busy-id');\r\n            if (event.detail.isActive) {\r\n\r\n                let busyDate = curObj.attr('busy-date'),\r\n                    busyTimes = curObj.attr('busy-time').split('-');\r\n\r\n                api.addBusyDate.set('onError', function (code, error, callback) {\r\n                    let errorMsg = error;\r\n                    if (code === 200) {\r\n                        if (error === 'Maximum on more the 3') {\r\n                            errorMsg = Languages.package['addTipOne'];\r\n                        }else if(errorMsg === 'The date of disabling'){\r\n                            errorMsg = Languages.package['addTipTwo'];\r\n                        }\r\n                    }\r\n                    mui.alert(`${errorMsg}`, '', 'OK');\r\n                    //debugger;\r\n                    mui(switchDate).switch().toggle();\r\n                });\r\n\r\n                api.addBusyDate({\r\n                    BusyBeginDate: `${busyDate} ${busyTimes[0]}`,\r\n                    BusyEndDate: `${busyDate} ${busyTimes[1]}`\r\n                }, function (data) {\r\n\r\n                });\r\n            } else {\r\n                if (busyId) {\r\n                    api.delBusyDate({id: busyId}, function (data) {\r\n                        //console.log(\"删除成功:\", busyId);\r\n                    });\r\n                }\r\n            }\r\n        })\r\n    }\r\n});\r\n\r\n\r\n//\r\n"]}