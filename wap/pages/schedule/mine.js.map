{"version":3,"sources":["/pages/schedule/mine.ts"],"names":[],"mappings":"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","file":"mine.js","sourcesContent":["import {api} from '/js/api';\r\nimport {convert, dateTime, format, Languages, Store, string, url} from '/js/util';\r\n\r\napi({\r\n\tgetTime: 'system/GetExhibitionPublicData',\r\n\tmySchedule: 'user/GetCurUserActivitySchedule',\r\n\tbuyerDating: 'schedule/GetBuyerSchedules',\r\n\texhibitionDating: 'schedule/GetExhibitionSchedules',\r\n\tgetBusyDateByBarCode: 'userBusyDate/GetBusyDateByBarCode',\r\n});\r\n\r\ntemplate.defaults.imports.dateFormat = format.date;\r\ntemplate.defaults.imports.parseInt = parseInt;\r\ntemplate.defaults.imports.log = console.log;\r\n\r\n\r\nconst roleName = (Store.get('RoleName') as string).toLowerCase();\r\nconst role = roleName === 'exhibition' ? 'exhibition' : 'buyer';\r\nconst stage = Store.get('Stage');\r\n\r\nfunction makeSerial(startTime: string, endTime: string) :string[] {\r\n\tlet st = startTime.split(':'), et = endTime.split(':');\r\n\r\n\tlet arr:string[]  = [];\r\n\r\n\tfor (let i = parseInt(st[0], 10) + (st[1] == '30' ? 0.5 : 0), l = parseInt(et[0], 10) + (et[1] == '30' ? 0.5 : 0); i < l; i += 0.5) {\r\n\t\tlet tick = '' + string.padLeft(~~i, 2) + (i % 1 === 0 ? ':00' : ':30');\r\n\t\tlet tick2 = '' + string.padLeft(~~(i + 0.5), 2) + ((i + 0.5) % 1 === 0 ? ':00' : ':30');\r\n\r\n\t\tarr.push(tick + '-' + tick2);\r\n\t}\r\n\r\n\treturn arr;\r\n}\r\n\r\n\r\ntype OnePartTime = {\r\n\tacts: Array;\r\n\tusable: boolean;\r\n\thasActivity: boolean;\r\n\thasAppointment: boolean;\r\n\tisBusy: boolean;\r\n\tshowAddTo: boolean;\r\n};\r\ntype OneDay = {\r\n\tdate: Date;\r\n\ttime: HashMap<OnePartTime>\r\n};\r\ntype FullDay = {\r\n\tlng: any;\r\n\troleName: string;\r\n\tstage: string;\r\n\tyear: number;\r\n\tdayArr: OneDay[];\r\n\tdays: HashMap<OneDay>;\r\n};\r\n\r\n\r\nlet fullObj: FullDay = {\r\n\tlng: Languages.package,\r\n\troleName,\r\n\tstage,\r\n\tyear: 2018,\r\n\tdayArr: [],\r\n\tdays: {},\r\n};\r\n\r\nlet scheduleData: any;\r\nlet datingData: any;\r\nlet busyDateData: any;\r\n\r\n$.when(\r\n\tapi.getTime(timeData => {\r\n\r\n\t\tlet startDate = new Date(Date.parse(timeData.beginDate));\r\n\t\tlet endDate = new Date(Date.parse(timeData.endDate));\r\n\t\tlet days = dateTime.daySpan(startDate, endDate) + 1;\r\n\r\n\t\tfullObj.year = startDate.getFullYear();\r\n\r\n\t\tfor (let a = 0, b = days; a < b; a++) {\r\n\t\t\tlet theDay = dateTime.addDays(startDate, a);\r\n\t\t\tlet dayObj = {\r\n\t\t\t\tdate: theDay,\r\n\t\t\t\ttime: {},\r\n\t\t\t};\r\n\t\t\tfullObj.days[format.date(theDay)] = dayObj;\r\n\t\t\tfullObj.dayArr.push(dayObj);\r\n\t\t}\r\n\r\n\r\n\t\tlet lunchTime = timeData.publicDate[0].dateTimes[0].split('-');\r\n\t\tlet unusableTimeArr = makeSerial(lunchTime[0], lunchTime[1]);\r\n\r\n\r\n\t\tlet startTime = timeData.beginTime, endTime = timeData.endTime;\r\n\r\n\t\t//console.warn(unusableTimeArr);\r\n\r\n\t\tlet timeSerial = makeSerial(startTime, endTime);\r\n\t\tfor (let d in fullObj.days) {\r\n\t\t\tlet alreadyAddedRestTime = false;\r\n\t\t\tlet dayObj = fullObj.days[d];\r\n\t\t\tlet canUse = true, willAdd = true;\r\n\t\t\ttimeSerial.forEach(spanStr => {\r\n\t\t\t\tif (unusableTimeArr.indexOf(spanStr) > -1) {\r\n\t\t\t\t\tif (alreadyAddedRestTime) {\r\n\t\t\t\t\t\twillAdd = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcanUse = false;\r\n\t\t\t\t\t\talreadyAddedRestTime = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcanUse = true;\r\n\t\t\t\t\twillAdd = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (willAdd) {\r\n\t\t\t\t\tdayObj.time[spanStr] = {\r\n\t\t\t\t\t\tusable: canUse,\r\n\t\t\t\t\t\tacts: [],\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}),\r\n\tapi.mySchedule(data => {\r\n\t\tscheduleData = data;\r\n\t}),\r\n\tapi[`${role}Dating`](data => {\r\n\t\tdatingData = data;\r\n\t}),\r\n\tapi.getBusyDateByBarCode(data => {\r\n\t\tbusyDateData = data;\r\n\t}),\r\n)\r\n\t.then(function () {\r\n\r\n\t\tmergeBusyDateData(fullObj, busyDateData);\r\n\t\tmergeAppointData(fullObj, datingData);\r\n\t\tmergeScheduleData(fullObj, scheduleData);\r\n\r\n\t\t// if(stage==='open diary' || stage==='pre-exhibiton' || stage==='exhibition') {\r\n\t\t\tif(stage==='open diary') {\r\n                if(!(roleName === 'visitor' && stage==='open diary')) {\r\n                    fullObj.dayArr.forEach((day: OneDay) => {\r\n                        for (let timeCode: string in day.time) {\r\n                            let timeSlot = day.time[timeCode];\r\n                            if (!timeSlot.hasAppointment  && !timeSlot.isBusy) {\r\n                                timeSlot.showAddTo = true;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n\t\t\tconsole.log(fullObj);\r\n\r\n\t\t\tdocument.getElementById('divSec').innerHTML = template('tpl', fullObj);\r\n\r\n\r\n\r\n\r\n\r\n\t\t\tconst role = Store.get('RoleName');\r\n\r\n\t\t\t$('#tbSchedule').on('click', '.mc', function () {\r\n\t\t\t\tlocation.href = '../meetings/detail.html' + this.getAttribute('data-search') + '&comepage=schedule';\r\n\t\t\t}).on('click', '.pt', function () {\r\n\t\t\t\tlet keys = this.getAttribute('data-key').split('/');\r\n\t\t\t\tlet obj: any = fullObj.dayArr[keys[0]].time[keys[1]].acts[keys[2]];\r\n\r\n\t\t\t\t//console.log(obj);\r\n\t\t\t\tStore.set(`Apt_${obj.barcode}`, obj);\r\n\t\t\t\t//console.log(this.getAttribute('data-aid'));\r\n\t\t\t\tlocation.href = '../meetings/detailAppoint.html?aid=' + obj.barcode;\r\n\t\t\t}).on('click', '.divAddTo', function (e) {\r\n\r\n\t\t\t\tlet target;\r\n\t\t\t\tif (role === 'exhibition') {\r\n\t\t\t\t\ttarget = __uri('../buyer/buyer1.html');\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttarget = __uri('../exhibitors/exhibitors1.html');\r\n\t\t\t\t}\r\n\t\t\t\tlet curTimes = e.target.getAttribute('data-time').split('-');\r\n\t\t\t\tlet beginDateTime = e.target.getAttribute('data-date') + ' ' + curTimes[0];\r\n\t\t\t\tlet endDateTime = e.target.getAttribute('data-date') + ' ' + curTimes[1];\r\n\t\t\t\t//console.log(beginDateTime, endDateTime);\r\n\t\t\t\tStore.set('scheduleAddtoTime',beginDateTime+'|' + endDateTime);\r\n\t\t\t\tlocation.href = url.setParam(target, {\r\n\t\t\t\t\tfrom: 'schedule',\r\n                    info: `${beginDateTime} ~ ${endDateTime}`\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t);\r\n\r\n//被占用时间段\r\nfunction mergeBusyDateData(fullObj:FullDay, busyDateData){\r\n\r\n\tif (busyDateData && busyDateData.length) {\r\n\r\n\t\tbusyDateData.forEach((it, index) => {\r\n\r\n\t\t\tlet //beginDate = convert.stringToDate(it.busybegindate),\r\n\t\t\t\tbeginDateDay: string = it.busybegindate.substr(0, 10),\r\n\t\t\t\tbeginTime: string = it.busybegindate.substr(11, 5),\r\n\t\t\t\tendTime: string = it.busyenddate.substr(11, 5),\r\n\t\t\t\ttarDay: OneDay = fullObj.days[beginDateDay];\r\n\r\n\t\t\t//console.log(beginDateDay,beginTime,endTime);\r\n\r\n\t\t\tif (tarDay) {\r\n\t\t\t\tlet timeArr = makeSerial(beginTime, endTime);\r\n\t\t\t\ttimeArr.forEach((timecode: string) => {\r\n\t\t\t\t\tlet timePart: OnePartTime = tarDay.time[timecode];\r\n\t\t\t\t\tif (timePart && timePart.usable) {\r\n\t\t\t\t\t\ttimePart.isBusy = true;\r\n\t\t\t\t\t\tit.cantAdd = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tit.cantAdd = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\tif (it.cantAdd)\r\n\t\t\t\t\tconsole.warn('BusyDate', it);\r\n\t\t\t\telse\r\n\t\t\t\t\tdelete it.cantAdd;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\n//面谈\r\nfunction mergeAppointData(fullObj:FullDay, datingData){\r\n\r\n\tif (datingData && datingData.length) {\r\n\r\n\r\n\t\tdatingData.forEach((it, index) => {\r\n\t\t\tlet dateStr = it.begindate.split(' ')[0],\r\n\t\t\t\ttarDay: OneDay = fullObj.days[dateStr];\r\n\r\n\t\t\tif (tarDay) {\r\n\t\t\t\tlet fromTimeStr;\r\n\t\t\t\tif (it.begindate.substr(14, 2) == '15') {\r\n\t\t\t\t\tfromTimeStr = it.begindate.substr(0, 14) + '00:00';\r\n\t\t\t\t}\r\n\t\t\t\telse if (it.begindate.substr(14, 2) == '45') {\r\n\t\t\t\t\tfromTimeStr = it.begindate.substr(0, 14) + '30:00';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfromTimeStr = it.begindate;\r\n\t\t\t\t}\r\n\t\t\t\tlet fromTime = convert.stringToDate(fromTimeStr);\r\n\t\t\t\tlet toTime = convert.stringToDate(it.enddate);\r\n\t\t\t\tlet arrTimes = [fromTime];\r\n\r\n\t\t\t\twhile (true) {\r\n\t\t\t\t\tfromTime = dateTime.addSeconds(fromTime, 30 * 60);\r\n\t\t\t\t\tarrTimes.push(fromTime);\r\n\t\t\t\t\tif (fromTime.valueOf() >= toTime.valueOf()) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//console.log('arrTimes', arrTimes);\r\n\t\t\t\t//\r\n\t\t\t\tarrTimes.forEach((date, i) => {\r\n\t\t\t\t\t//\r\n\t\t\t\t\tif (i > 0) {\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\tlet time = format.date(arrTimes[i - 1], 'HH:mm') + '-' + format.date(date, 'HH:mm');\r\n\t\t\t\t\t\t//console.log('time', i, time);\r\n\r\n\t\t\t\t\t\tlet timePart: OnePartTime = tarDay.time[time];\r\n\t\t\t\t\t\tif (timePart && timePart.usable) {\r\n\r\n\t\t\t\t\t\t\tit.isAppoint = true;\r\n\t\t\t\t\t\t\tit.informationtype = 3;\r\n\t\t\t\t\t\t\tit.activity_id = it.id;\r\n\t\t\t\t\t\t\tit.accept = 1;\r\n\t\t\t\t\t\t\ttimePart.acts.push(it);\r\n\r\n\t\t\t\t\t\t\ttimePart.hasAppointment = true;\r\n\t\t\t\t\t\t\tit.cantAdd = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tit.cantAdd = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (it.cantAdd)\r\n\t\t\t\t\t\t\tconsole.warn('AppointDate', it);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdelete it.cantAdd;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t});\r\n\r\n\r\n\t}\r\n}\r\n\r\n//活动或会议 SCHDULE\r\nfunction mergeScheduleData(fullObj:FullDay, scheduleData){\r\n\tif (scheduleData && scheduleData.length) {\r\n\r\n\r\n\t\tscheduleData.forEach((it, index) => {\r\n\t\t\tlet dateStr: string = it.begindate.split(' ')[0], tarDay: OneDay = fullObj.days[dateStr];\r\n\r\n\t\t\tif (tarDay) {\r\n\t\t\t\tlet occupyTimes: Array = it.occupytime.split(',');//10:30-11:00,15:30-16:00\r\n\t\t\t\toccupyTimes.forEach(timeRange => {\r\n\t\t\t\t\ttimeRange = timeRange.replace(/ /g, '');\r\n\t\t\t\t\tlet timePart: OnePartTime = tarDay.time[timeRange];\r\n\r\n\t\t\t\t\tif (timePart && timePart.usable) {\r\n\t\t\t\t\t\ttimePart.hasActivity = true;\r\n\t\t\t\t\t\ttimePart.acts.push(it);\r\n\t\t\t\t\t\t/*if (stage == 'open diary' || stage == 'pre-exhibiton' || stage == 'exhibition') {\r\n\t\t\t\t\t\t\ttarDay.time[timeRange].acts.push({\r\n\t\t\t\t\t\t\t\tinformationtype: 4\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\tit.cantAdd = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tit.cantAdd = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (it.cantAdd)\r\n\t\t\t\t\tconsole.warn('ScheduleDate', it);\r\n\t\t\t\telse\r\n\t\t\t\t\tdelete it.cantAdd;\r\n\t\t\t}\r\n\r\n\r\n\t\t});\r\n\r\n\t}\r\n}\r\n\r\n\r\n$('#btnExport').click(function () {\r\n\t// alert(Languages.package.exportResult);\r\n});\r\n\r\n"]}