{"version":3,"sources":["/pages/msgBox/msgBox.ts"],"names":[],"mappings":"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","file":"msgBox.js","sourcesContent":["import {api} from '/js/api';\r\nimport {Languages, Store, format} from '/js/util';\r\n\r\napi({\r\n    getUnreadList: 'message/GetMessageByCurrentUser', //0未读，1已读，其他为全部\r\n    getReadList: 'message/GetMessageByCurrentUser', //0未读，1已读，其他为全部\r\n    setRead: 'message/UpMessageStatusByMsgId?status=1', //1 已读\r\n    reply: 'activity/AllowOrDenyActivityContentForUser', // 0是拒绝 1是同意\r\n    replySchedule: 'schedule/AllowOrDenyScheduleForUser', // 0是拒绝 1是同意\r\n});\r\n\r\n\r\nlet curLng = Store.get('lngPkg');\r\n\r\napi.replySchedule.set('onError',function(code , error, callback){\r\n    if (code === 200 && (error === 'AllowOrDenyScheduleForUser_Error01' || error === 'AllowOrDenyScheduleForUser_Error02' || error === 'AllowOrDenyScheduleForUser_Error03'))\r\n    {\r\n        let errorMsg = Languages.package['tips'];\r\n        mui.alert(`${errorMsg}`, Languages.package['tipsTitle'], Languages.package['okb']);\r\n    }\r\n});\r\n\r\n\r\nlet customParse = function (msg) {\r\n    let msgObj = JSON.parse(msg);\r\n    if (curLng == 'cn') {\r\n        return Languages.package['scheduleMsgTpl']\r\n            .replace('{company}', msgObj.fromCompanyCn ? `${msgObj.fromCompanyCn}公司` : '')\r\n            .replace('{title}', msgObj.fromTitleCn ? `${msgObj.fromTitleCn}` : '')\r\n            .replace('{name}', msgObj.fromNameCn)\r\n            .replace('{time}', msgObj.date);\r\n    } else {\r\n        return Languages.package['scheduleMsgTpl']\r\n            .replace('{company}', msgObj.fromCompany ? `${msgObj.fromCompany} Company ` : '')\r\n            .replace('{title}', msgObj.fromTitle ? `${msgObj.fromTitle}` : '')\r\n            .replace('{name}', msgObj.fromName)\r\n            .replace('{time}', msgObj.date);\r\n    }\r\n\r\n};\r\n\r\nlet customParse2 = function (msg) {\r\n    let msgObj = JSON.parse(msg);\r\n    console.log(msgObj);\r\n    return msgObj.message?`${msgObj.message}`:'';\r\n};\r\n\r\ntemplate.defaults.imports.customParse = customParse;\r\ntemplate.defaults.imports.customParse2 = customParse2;\r\n\r\nlet htmlFormat=function(msg) {\r\n    let msgarray=msg.split(\"|\");\r\n    return msgarray\r\n};\r\n\r\ntemplate.defaults.imports.htmlFormat = htmlFormat;\r\n\r\nlet render = template.compile(document.getElementById('tpl-msg').innerHTML);\r\n\r\nlet ulUnread = document.getElementById('ulUnread');\r\nlet ulRead = document.getElementById('ulRead');\r\n\r\nlet getUnreadList = function () {\r\n    api.getUnreadList({status: 0}, data => {\r\n        let json = {\r\n            data,\r\n            lpg: Languages.package\r\n        };\r\n        ulUnread.innerHTML = render(json);\r\n    });\r\n};\r\ngetUnreadList();\r\n\r\n\r\n$(ulUnread).add(ulRead).on('click', '.btnAgree,.btnDeny', function () {\r\n    let btn = $(this), activityContentId = ~~btn.data('acid'), accept = ~~btn.data('accept'),\r\n        type = ~~btn.data('type');\r\n    if (type == 3) {\r\n        api.replySchedule({id: activityContentId, accept}, data => {\r\n            btn.parent().replaceWith($(`<div class=\"acceptTxt\">${accept == 1 ? Languages.package.agreed : Languages.package.denied}</div>`))\r\n        });\r\n    } else {\r\n        api.reply({activityContentId, accept}, data => {\r\n            btn.parent().replaceWith($(`<div class=\"acceptTxt\">${accept == 1 ? Languages.package.agreed : Languages.package.denied}</div>`))\r\n        });\r\n    }\r\n\r\n\r\n});\r\n\r\nlet getReadList = function () {\r\n    api.getReadList({status: -1}, data => {\r\n        let json = {\r\n            data,\r\n            lpg: Languages.package\r\n        };\r\n        ulRead.innerHTML = render(json);\r\n    });\r\n};\r\ngetReadList();\r\n\r\n$('#msgWhole').on('tap', '.unread', function () {\r\n    let sender = this;\r\n    api.setRead({msgId: this.getAttribute('data-id')}, data => {\r\n        sender.className = 'mui-navigate-right';\r\n    })\r\n});\r\nmui(\"#segmentedControl\").on('tap', '.mui-control-item', function () {\r\n    let href = this.getAttribute(\"href\");\r\n    if (href == '#divUnread') {\r\n        getUnreadList();\r\n    } else if (href == '#divRead') {\r\n        getReadList();\r\n    }\r\n});\r\n\r\n\r\n\r\n"]}