{"version":3,"sources":["/pages/navigation/FMap.ts"],"names":[],"mappings":"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","file":"FMap.js","sourcesContent":["import {FloorSelector, SelOption} from './FloorSelector';\r\nimport {Languages} from '/js/util';\r\n\r\nexport default class FMap {\r\n\r\n\tfloorSelector: FloorSelector;\r\n\tmap;\r\n\tnav;\r\n\tsearchAnalyser;\r\n\r\n\r\n\toSeachText: HTMLInputElement;\r\n\toHotwords: HTMLUListElement;\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.initMap('10347', 'ITB', '7be95456a5867df0cb3b276dadeb52ad');\r\n\t}\r\n\r\n\tinitMap(mapID: string, appName: string, appKey: string) {\r\n\t\twindow['map'] = this.map = new fengmap.FMMap({\r\n\t\t\t//渲染dom\r\n\t\t\tcontainer: document.getElementById('fengMap'),\r\n\t\t\t//地图数据位置\r\n\t\t\tmapServerURL: './assets/data/' + mapID,\r\n\t\t\t//主题数据位置\r\n\t\t\tmapThemeURL: './assets/data/theme',\r\n\t\t\t//设置主题\r\n\t\t\tdefaultThemeName: '3007',\r\n\t\t\t// 默认比例尺级别设置为20级\r\n\t\t\tdefaultMapScaleLevel: 20,\r\n\t\t\t//对不可见图层启用透明设置 默认为true\r\n\t\t\tfocusAlphaMode: false,\r\n\t\t\t//关闭聚焦层切换的动画显示\r\n\t\t\tfocusAnimateMode: false,\r\n\t\t\t//对不聚焦图层启用透明设置，当focusAlphaMode = true时有效\r\n\t\t\tfocusAlpha: 0.1,\r\n\t\t\t//开启2维，3维切换的动画显示\r\n\t\t\tviewModeAnimateMode: true,\r\n\t\t\t//设置最大倾斜角\r\n\t\t\tdefaultMaxTiltAngle: 80,\r\n\t\t\t//设置倾斜角，默认倾斜角为60度\r\n\t\t\tdefaultTiltAngle: 30,\r\n\t\t\t//开发者申请应用下web服务的key\r\n\t\t\tkey: appKey,\r\n\t\t\t//开发者申请应用名称\r\n\t\t\tappName: appName,\r\n\t\t});\r\n\r\n\t\tthis.map.openMapById(mapID);\r\n\r\n\t\t//地图加载完成回调\r\n\t\tthis.map.on('loadComplete', () => {\r\n\t\t\t//默认楼层加载完后不显示，需自定义设置要显示的楼层和聚焦层\r\n\t\t\tthis.map.visibleGroupIDs = this.map.groupIDs;\r\n\t\t\tthis.map.focusGroupID = this.map.groupIDs[0];\r\n\t\t\tlayerGroup.init(this.map.listGroups, this.map.focusGroupID);\r\n\r\n\t\t\t//获取搜索类\r\n\t\t\tthis.searchAnalyser = this.map.searchAnalyser;\r\n\t\t\t//\r\n\t\t\tthis.initSearcher();\r\n\r\n\t\t\tthis.nav = new fengmap.FMNavigation({\r\n\t\t\t\tmap: this.map,\r\n\t\t\t\tlineStyle: {\r\n\t\t\t\t\tlineType: fengmap.FMLineType.FMARROW,\r\n\t\t\t\t\tlineWidth: 6,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\r\n\t}\r\n\r\n\tfindCoordinate(fid) {\r\n\t\tthis.oHotwords.style.display = 'none';\r\n\t\tlet searchReq = new fengmap.FMSearchRequest(fengmap.FMNodeType.MODEL);\t\t//设置查询地图元素类型\r\n\t\tsearchReq.FID(fid);\r\n\t\tthis.searchAnalyser.query(searchReq, (request, result) => {\r\n\t\t\t//result 为查询到的结果集。\r\n\t\t\tlet models = result[0];\r\n\t\t\tif (models != null) {\r\n\t\t\t\tthis.filldata(models);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfilldata(model) {\r\n\t\tthis.addMarkers(model.groupID, model.mapCoord.x, model.mapCoord.y);\r\n\r\n\t\tlet coord = {\r\n\t\t\tx: model.mapCoord.x,\r\n\t\t\ty: model.mapCoord.y,\r\n\t\t\tgroupID: model.groupID,\r\n\t\t};\r\n\t\tthis.moveTo(coord); //定位跳转\r\n\r\n\t\t//地图上当前设置的模型元素处于高亮状态。\r\n\t\t//如果最后一个参数设置为true,storeSelect(model,true,true)，表示之前的和当前的模型都处于高亮转态。可使用map.selectNull()方法清除。\r\n\t\tthis.map.storeSelect(model, true, false);\r\n\r\n\t}\r\n\r\n\tmoveTo(coord) {\r\n\t\tthis.map.visibleGroupIDs = [coord.groupID];\r\n\t\tthis.map.focusGroupID = coord.groupID;\r\n\t\tthis.map.moveTo(coord);\r\n\t}\r\n\r\n\t//添加Marker\r\n\taddMarkers(gid, X, Y) {\r\n\t\tthis.removeMarkers();\r\n\t\tlet group = this.map.getFMGroup(gid);\r\n\r\n\t\t//返回当前层中第一个imageMarkerLayer,如果没有，则自动创建\r\n\t\tlet layer = group.getOrCreateLayer('imageMarker');\r\n\r\n\t\tlet im = new fengmap.FMImageMarker({\r\n\t\t\tx: X,\r\n\t\t\ty: Y,\r\n\t\t\turl: './assets/image/blueImageMarker.png',\r\n\t\t\tsize: 32,\r\n\t\t\tcallback: function () {\r\n\t\t\t\tim.alwaysShow();\r\n\t\t\t},\r\n\t\t});\r\n\t\tlayer.addMarker(im);\r\n\t}\r\n\r\n\tremoveMarkers() {\r\n\t\t//获取多楼层Marker\r\n\t\tthis.map.callAllLayersByAlias('imageMarker', (layer) => {\r\n\t\t\tlayer.removeAll();\r\n\t\t});\r\n\t}\r\n\r\n\tinitSearcher() {\r\n\t\tthis.oSeachText = document.getElementById('seachText') as HTMLInputElement;\r\n\t\tthis.oHotwords = document.getElementById('hotwords') as HTMLUListElement;\r\n\r\n\t\tlet that = this;\r\n\t\t//创建提示下拉框\r\n\t\tlet createLi = function (data) {\r\n\t\t\tthat.oHotwords.innerHTML = '';\r\n\t\t\tlet li = '';\r\n\t\t\tfor (let i in data) {\r\n\t\t\t\tlet model = data[i];\r\n\t\t\t\tli += '<li data-id=\"' + model.FID + '\">' + (!model.name ? '空' : model.name) + '</li>';\r\n\t\t\t}\r\n\r\n\t\t\tthat.oHotwords.innerHTML = li;\r\n\t\t\tlet aLi = that.oHotwords.getElementsByTagName('li');\r\n\t\t\tfor (let i = 0; i < aLi.length; i++) {\r\n\t\t\t\t(function (i) {\r\n\t\t\t\t\taLi[i].onclick = function () {\r\n\t\t\t\t\t\tlet index = i;\r\n\t\t\t\t\t\tthat.oSeachText.value = this.innerHTML;\r\n\t\t\t\t\t\tlet fid = this.attributes['data-id'].nodeValue;\r\n\t\t\t\t\t\tthat.findCoordinate(fid);\r\n\t\t\t\t\t\tthat.oHotwords.style.display = 'none';\r\n\t\t\t\t\t};\r\n\t\t\t\t})(i);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//根据关键字查询店铺\r\n\t\tthis.oSeachText.addEventListener('keyup', (e) => {\r\n\t\t\tlet keyword = this.oSeachText.value;\r\n\t\t\tif (keyword !== '') {\r\n\t\t\t\tlet searchReq = new fengmap.FMSearchRequest(fengmap.FMNodeType.MODEL);\r\n\t\t\t\tsearchReq.keyword(keyword);\r\n\t\t\t\tthis.searchAnalyser.query(searchReq, (request, result) => {\r\n\t\t\t\t\tlet models = result;\r\n\t\t\t\t\tif (models != null && models.length > 0) {\r\n\t\t\t\t\t\tthis.oHotwords.style.display = 'block';\r\n\t\t\t\t\t\tcreateLi(models);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.oHotwords.style.display = 'none';\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t//楼层选择器\r\n\tinitFloorSelector() {\r\n\r\n\t\tlet floorArr: SelOption[] = [\r\n\t\t\t{value: 1, text: Languages.package.floor1},\r\n\t\t\t{value: 2, text: Languages.package.floor2},\r\n\t\t];\r\n\r\n\r\n\t\tthis.floorSelector = new FloorSelector(floorArr, 'sel1');\r\n\t\tthis.floorSelector.button.addEventListener('tap', (event) => {\r\n\t\t\tthis.floorSelector.picker.show((items) => {\r\n\t\t\t\tthis.floorSelector.button.innerText = items[0].text;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n\r\n"]}